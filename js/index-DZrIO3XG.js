import{r as h,b as v,j as t,a as o}from"./index-CybXJaB_.js";import{u as N}from"./useInfiniteQuery-DSCseih0.js";import{g as j}from"./cloudgaming-CMuG5WXl.js";const w=()=>{const x=h.useRef(null),u=v(),{data:r,fetchNextPage:m,hasNextPage:n,isFetchingNextPage:i,isLoading:d}=N({queryKey:["cloudGameLogs"],queryFn:({pageParam:e=1})=>j({page:e,page_size:20}),getNextPageParam:(e,s)=>{const a=e.data.total??0,l=e.data.page_size??20;if(l===0||a===0)return;const b=Math.ceil(a/l),f=s.length+1;return f>b?void 0:f},initialPageParam:1});h.useEffect(()=>{const e=x.current;if(!e)return;const s=()=>{e.scrollHeight-e.scrollTop<=e.clientHeight+1&&n&&!i&&m()};return e.addEventListener("scroll",s),()=>e.removeEventListener("scroll",s)},[n,i,m]);const c=(r==null?void 0:r.pages.flatMap(e=>e.data.list??[]))??[],g=e=>{const s=Math.floor(e/3600),a=Math.floor(e%3600/60),l=e%60;return`${s>0?`${s}小时`:""}${a>0?`${a}分钟`:""}${l}秒`},p=e=>{u(`/service/time-usage/${e.id}`,{state:{log:e}})};return t.jsxs("div",{className:o("w-full h-full bg-transparent mt-5 pl-3","flex flex-col"),children:[t.jsx("h1",{className:"text-xs text-b65 flex-shrink-0",children:"时长使用明细"}),t.jsxs("div",{ref:x,className:o("flex-1 overflow-y-auto mt-3","w-[calc(100%+4rem)] -mx-8"),children:[d?t.jsx("div",{className:"text-center py-4 text-xs text-b65",children:"正在加载中..."}):c.map(e=>t.jsxs("button",{type:"button",className:o("flex items-center justify-between w-full","border-b last:border-b-0 border-b5","text-b100","py-2.5 pl-8 pr-10","bg-b10","cursor-pointer hover:bg-b20"),onClick:()=>p(e),children:[t.jsxs("div",{className:"flex flex-col gap-1.5 text-left",children:[t.jsx("span",{className:"text-sm",children:e.name}),t.jsx("span",{className:"text-xs text-b65",children:new Date(e.start_time*1e3).toLocaleString()})]}),t.jsx("div",{className:"flex flex-col items-end gap-1.5",children:t.jsxs("span",{className:"text-sm font-bold",children:["-",g(e.use_time)]})})]},e.id)),i&&t.jsx("div",{className:"text-center py-4 text-xs text-b65",children:"正在加载中..."}),!n&&c.length>0&&t.jsx("div",{className:"text-center py-4 text-xs text-b65",children:"已经到底啦~"}),c.length===0&&!d&&t.jsx("div",{className:"text-center py-4 text-xs text-b65",children:"暂无使用记录"})]})]})};export{w as default};
