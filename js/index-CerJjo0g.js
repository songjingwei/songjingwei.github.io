import{a as m,j as e,m as w,b as P,r,aq as L,X as k,$ as B,D as I,ay as T,a3 as v,aA as _,aB as E,aC as F,aD as H}from"./index-CybXJaB_.js";import{u as Q}from"./useProvidersQuery-D_r0QIrS.js";import{A as $}from"./AccountCancellationDialog-CQlF0lNa.js";import{u as q}from"./useWindowSize-BAZYuwnF.js";import"./checkbox-DaNQsd72.js";import"./Circle_Warning-CDUc_EXn.js";import"./index-Bq0sdVVw.js";import"./useVerifyCodeMutation-yTHkI_Sq.js";import"./useCountdown-Dr_XpM1o.js";const N=({label:t,value:a,onClick:i,isBound:d})=>{const l=()=>{i==null||i()},x=m("text-b60",d&&"text-[var(--Primary-5)]");return e.jsxs("button",{type:"button",className:m("w-full bg-b10 backdrop-blur-lg px-4 py-3","w-[calc(100%+2em)] -mx-4","flex items-center justify-between","text-b100 text-sm","active:bg-b20 transition-colors duration-200"),onClick:l,children:[t,e.jsxs("div",{className:"flex items-center gap-x-2",children:[a&&e.jsx("span",{className:x,children:a}),e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",children:[e.jsx("title",{children:"chevron-right"}),e.jsx("path",{d:"M5.5 12.5L10.5 8L5.5 3.5",stroke:"#BAD7F5",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]})]})]})},G={wechatweb:{label:"微信",path:"wechat",unbindHint:"绑定微信后，可以通过微信授权登陆"},qq:{label:"QQ",path:"qq",unbindHint:"绑定QQ后，可以通过QQ授权登陆"},google:{label:"Google",path:"google",unbindHint:"绑定Google后，可以通过Google授权登陆"},steam:{label:"Steam",path:"steam",unbindHint:"登录后，可以同步和管理你的 Steam 游戏库",bindButtonText:"添加账号",unbindButtonText:"解除登录",boundText:"已登录"}},j=t=>e.jsx("p",{className:"text-b65 text-lg",children:t.title}),O=()=>{const{currentUser:t}=w(),a=P(),i=w(s=>s.refreshThirdPartyBindings),[d,l]=r.useState(!1),x=r.useId(),p=r.useMemo(()=>{if(t!=null&&t.mobile)return t.mobile.split("-")[0]},[t]),y=r.useMemo(()=>{if(t!=null&&t.mobile)return t.mobile.split("-")[1]},[t]),g=!!(t!=null&&t.mobile),{data:c}=Q("cn"),C=r.useMemo(()=>c?c.filter(s=>s.provider!=="steam"):[],[c]),S=s=>t!=null&&t.thirdParty&&t.thirdParty.find(o=>o.provider===s&&o.is_bound)||null,A=s=>s.map(o=>{const u=G[o.provider],b=S(o.provider),h=(b==null?void 0:b.is_bound)||!1,n=e.jsx("div",{className:"flex items-center",children:e.jsx("div",{className:"w-13",children:u.label})});return e.jsx(N,{label:n,value:h?u.boundText||"已绑定":"未绑定",isBound:h,onClick:h?()=>a(`/mobile-user/${u.path}`):()=>k(u.path)},o.provider)}),D=async s=>{try{const o=await T(s);o.code===200?(v.success("设置主账户成功"),await i()):v.error(o.message||"设置主账户失败")}catch(o){console.error("设置主账户失败:",o),v.error("设置主账户失败")}},M=()=>{var b,h;const s=((b=t==null?void 0:t.thirdParty)==null?void 0:b.filter(n=>n.provider==="steam"&&n.is_bound))||[],u=((h=t==null?void 0:t.steamInfo)==null?void 0:h.Status)===2;return e.jsxs(e.Fragment,{children:[s.map(n=>{const f=n.is_main===1;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:m("w-full bg-b10 backdrop-blur-lg px-4 py-3","w-[calc(100%+2em)] -mx-4","flex items-center justify-between gap-3"),children:[e.jsx("div",{className:"text-b100 text-sm font-medium flex-shrink-0",children:n.nickname||"Steam用户"}),e.jsxs("div",{className:"flex items-center gap-2.5 flex-shrink-0",children:[e.jsx("button",{type:"button",onClick:()=>D(n.bind_id),disabled:f,className:m("py-[3px] px-3 rounded-2xl whitespace-nowrap","text-xs font-medium","transition-colors duration-200",f?"bg-b15 text-b100 cursor-default":"bg-b10 text-b65 hover:bg-b20 hover:text-b100 active:bg-b30"),children:f?"当前主账户":"设为主账号"}),e.jsx("button",{type:"button",onClick:()=>a("/mobile-user/steam"),className:m("py-[3px] px-3 rounded-2xl whitespace-nowrap","bg-b5 text-b65","text-xs font-medium","hover:bg-b30 hover:text-b100","active:bg-b30","transition-colors duration-200"),children:"解除"})]})]},`steam-${n.bind_id}`),f&&u&&e.jsxs("div",{className:"w-[calc(100%+2em)] -mx-4 flex items-center gap-2 px-4 py-2 text-xs",style:{backgroundColor:"rgba(249, 216, 2, 0.1)"},children:[e.jsx(B,{className:"w-4 h-4 flex-shrink-0 text-[#F9D802]"}),e.jsx("span",{className:"text-[#F9D802]",children:"游戏资料未公开，查看公开教程"}),e.jsxs("button",{type:"button",onClick:()=>{window.open("https://help.steampowered.com/zh-cn/faqs/view/588C-C67D-0251-C276","_blank")},className:"flex items-center gap-0.5 text-[#1796E2] hover:text-[#1796E2]/80 transition-colors",children:[e.jsx("span",{className:"underline",children:"前往"}),e.jsx(I,{color:"#1796E2",opacity:1})]})]},`steam-privacy-notice-${n.bind_id}`)]})}),e.jsxs("button",{type:"button",onClick:()=>{if(s.length===0){const n=window.location.hash.slice(1);localStorage.setItem("redirectAfterAuth",n),k("steam")}else a("/mobile-user/manage-steam")},className:m("w-[calc(100%+2em)] -mx-4","flex items-center justify-center gap-2","py-3 px-4","bg-b10 backdrop-blur-lg","border-t border-b10","text-sm font-normal text-b100","hover:bg-b20 transition-colors"),children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:[e.jsx("title",{children:"添加图标"}),e.jsx("path",{d:"M8 3.5V12.5M3.5 8H12.5",stroke:`url(#${x})`,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:x,x1:"3.5",y1:"8",x2:"12.5",y2:"8",gradientUnits:"userSpaceOnUse",children:[e.jsx("stop",{offset:"0.02",stopColor:"rgba(223, 239, 255, 1)"}),e.jsx("stop",{offset:"1",stopColor:"rgba(186, 215, 245, 1)"})]})})]}),"添加账号"]},"steam-add")]})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col gap-y-3",children:[e.jsxs("div",{className:"flex flex-col gap-y-3",children:[e.jsx(j,{title:"手机号绑定"}),e.jsx(N,{label:"手机号",isBound:g,value:g?`+${p} ${L(y)}`:"未绑定",onClick:g?()=>a("/mobile-user/phone"):void 0})]}),e.jsxs("div",{className:"flex flex-col gap-y-3",children:[e.jsx(j,{title:"管理第三方账号"}),e.jsx("div",{children:A(C)})]}),e.jsxs("div",{className:"flex flex-col gap-y-3",children:[e.jsx(j,{title:"Steam账号管理"}),e.jsx("div",{children:M()})]}),e.jsxs("div",{className:"flex flex-col gap-y-3",children:[e.jsx(j,{title:"账号与安全"}),e.jsx(N,{label:"账号注销",isBound:!1,onClick:()=>l(!0)})]})]}),d&&e.jsx($,{open:d,onOpenChange:l,fullscreen:!0})]})},U=()=>{const t=P(),a=w(c=>c.logout),i=w(c=>c.currentUser),{openLogoutDialog:d,closeLogoutDialog:l,setLogoutCallbacks:x}=_(),{width:p}=q();r.useEffect(()=>{p&&p>1024&&t("/user")},[p,t]),r.useEffect(()=>{window.scrollTo(0,0)},[]);const y=r.useCallback(()=>{x(()=>{console.log("执行退出登录操作..."),a(),l(),v.success("退出成功！"),t("/login")},()=>{console.log("取消退出登录操作。"),l()}),d()},[d,l,x,a,t]),g=r.useCallback(()=>{t("/login")},[t]);return e.jsxs("div",{className:"flex flex-col gap-y-4 min-h-screen",children:[e.jsx("div",{className:"-my-4",children:e.jsx(E,{})}),i&&e.jsxs(e.Fragment,{children:[e.jsx(F,{}),e.jsx(H,{}),e.jsx(O,{})]}),e.jsx("button",{type:"button",className:m("w-full bg-b10 backdrop-blur-lg px-4 py-3","w-[calc(100%+2em)] -mx-4 mb-4",!i&&"mt-4","flex items-center justify-center","text-sm",i?"text-[var(--Danger-5)]":"text-b100","active:bg-b20 transition-colors duration-200"),onClick:i?y:g,children:i?"退出登录":"前往登录"})]})};export{U as default};
