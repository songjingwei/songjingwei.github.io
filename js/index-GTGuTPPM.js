import{m as H,r as a,ao as J,aL as K,o as O,a3 as c,aQ as X,j as e,a as d,ar as f,aM as Y,at as Z,as as ee,B as te,k as P}from"./index-CybXJaB_.js";import{L as re}from"./login-logo-Bs7gJD3W.js";import{C as se}from"./checkbox-DaNQsd72.js";import{u as ae}from"./useVerifyCodeMutation-yTHkI_Sq.js";import{u as oe}from"./useAreaCodes-D6g38FIU.js";const ne="_authForm_1y389_2",A={authForm:ne},ie=()=>{var C;const{login:u}=H(),g=a.useId(),[b,L]=a.useState(null),[le,E]=a.useState(null),[ce,I]=a.useState(!1),[v,F]=a.useState(null),[B,w]=a.useState(!1),N=oe().map(t=>({name:t.name,code:t.code.replace("+","")})),p=a.useCallback(()=>{const t=window.location.search,r=new URLSearchParams(t),s=r.get("refreshToken"),o=r.get("token"),n=r.get("login")==="true",l=r.get("provider");return{refresh_token:s,token:o,hasLogined:n,provider:l}},[]);a.useEffect(()=>{(async()=>{const{refresh_token:r,token:s,hasLogined:o,provider:n}=p();if(L(s),E(r),I(o),F(n),s&&r&&o){w(!0);try{await u({access_token:s,refresh_token:r});const l=localStorage.getItem("redirectAfterAuth");if(l){localStorage.removeItem("redirectAfterAuth");const h=`${window.location.origin}/#${l}`;window.location.replace(h)}else window.location.replace("/")}catch(l){console.error("登录失败:",l),c.error("登录失败，请重试"),w(!1)}}})()},[u,p]);const{control:m,handleSubmit:V,trigger:$,getValues:_,setValue:z,formState:{errors:i}}=J({mode:"all",defaultValues:{phoneNumber:{areaCode:((C=N[0])==null?void 0:C.code)||"86",phoneNumber:""},verificationCode:"",termsAccepted:!1}}),{errors:W}=K({control:m}),{mutate:R,isPending:D}=ae(),{mutate:T,isPending:j}=O({mutationFn:async({provider:t,data:r})=>await X(t,r),onSuccess:async t=>{c.success("绑定成功！");const{refresh_token:r,token:s}=p();if(!s||!r){c.error("缺少认证信息，请重新登录"),window.location.replace("/login");return}await u({access_token:s,refresh_token:r});const o=localStorage.getItem("redirectAfterAuth");if(o){localStorage.removeItem("redirectAfterAuth");const n=`${window.location.origin}/#${o}`;window.location.replace(n)}else{const n=`${window.location.origin}/#/explore`;window.location.replace(n)}},onError:t=>{console.error(t),t instanceof Error?c.error(t.message):c.error("绑定失败，请重试。")}}),[x,y]=a.useState(0),[U,k]=a.useState("输入短信中的验证码");a.useEffect(()=>{let t;return x>0&&(t=setInterval(()=>{y(r=>r-1)},1e3)),()=>clearInterval(t)},[x]),a.useEffect(()=>{const t=()=>{const o=document.createElement("canvas").getContext("2d");if(!o)return;o.font="14px system-ui, -apple-system, sans-serif";const n="输入短信中的验证码",l="输入验证码",h=o.measureText(n).width,S=110,G=window.innerWidth<768?S:S+50;h>G?k(l):k(n)};t();const r=()=>{t()};return window.addEventListener("resize",r),()=>{window.removeEventListener("resize",r)}},[]);const Q=()=>{y(60)},q=async()=>{var r;await $("phoneNumber")?R({scene:"register",target:_("phoneNumber.phoneNumber"),type:"sms",zone_code:_("phoneNumber.areaCode")},{onSuccess:s=>{Q(),z("verificationCode",s.data)},onError:s=>{console.error("发送验证码失败：",s.message),c.error(s.message)}}):console.log("手机号校验失败",(r=W.phoneNumber)==null?void 0:r.message)},M=t=>{if(!v||!b){c.error("缺少第三方认证信息，无法绑定。");return}T({provider:v,data:{code:t.verificationCode,mobile:t.phoneNumber.phoneNumber,zone_code:t.phoneNumber.areaCode,token:b,type:"mobile"}})};return B?e.jsxs("div",{className:d("relative box-border flex flex-col items-center justify-center z-20","p-9","w-full max-w-[400px]","gap-6",A.authForm,"min-h-[300px]"),children:[e.jsx("div",{className:"w-[110px] h-[88px] blur-[82px] bg-[var(--Primary-5)] absolute -top-1.5 left-1/2 -translate-x-1/2 opacity-40 will-change-[filter]"}),e.jsxs("div",{className:"relative flex flex-col items-center gap-6",children:[e.jsxs("div",{className:"relative w-16 h-16",children:[e.jsx("div",{className:"absolute inset-0 rounded-full border-4 border-Primary-20"}),e.jsx("div",{className:"absolute inset-0 rounded-full border-4 border-transparent border-t-[var(--Primary-5)] animate-spin",style:{animationDuration:"1s"}})]}),e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("p",{className:"font-['Noto_Sans_SC:SemiBold',_sans-serif] font-semibold text-[var(--Primary-5)] text-lg",children:"登录成功"}),e.jsx("p",{className:"font-['Noto_Sans_SC:Regular',_sans-serif] font-normal text-[var(--Primary-5)]/70 text-sm",children:"正在为您跳转..."})]})]})]}):e.jsxs("form",{onSubmit:V(M),className:d("relative box-border flex flex-col items-center justify-start z-20","p-9","w-full max-w-[400px]","gap-9",A.authForm),children:[e.jsx("div",{className:"w-[110px] h-[88px] blur-[82px] bg-[var(--Primary-5)] absolute -top-1.5 left-1/2 -translate-x-1/2 opacity-40 will-change-[filter]"}),e.jsxs("div",{className:"flex flex-col gap-6 items-start justify-start p-0 relative shrink-0 w-full",children:[e.jsxs("div",{className:"box-border flex flex-col gap-3 items-start justify-start p-0 relative shrink-0 w-full",children:[e.jsx("div",{className:"box-border flex flex-row gap-2.5 items-start justify-end p-0 relative shrink-0 w-full",children:e.jsx("div",{className:"basis-0 font-['Noto_Sans_SC:Bold',_sans-serif] font-bold grow leading-[28px] text-[#dfefff] text-[20px] text-left",children:e.jsx("p",{children:"绑定手机号"})})}),e.jsx("div",{className:"font-['Noto_Sans_SC:Regular',_sans-serif] font-normal leading-[20px] relative shrink-0 text-[#bad7f5] text-[14px] text-left w-full",children:e.jsx("p",{children:"您已成功登录谷歌/微信/QQ/Steam账号，还需要绑定一下手机号"})})]}),e.jsxs("div",{className:"relative w-full",children:[e.jsx(f,{name:"phoneNumber",control:m,rules:{validate:{required:t=>t.phoneNumber.length>0||"手机号码不能为空",isNumeric:t=>/^\d+$/.test(t.phoneNumber)||"检测到非数字字符啦，试试只输入 11 位数字吧！",length:t=>t.phoneNumber.length===11||"请检查手机号码格式，国内手机号应为 11 位数字哦～"}},render:({field:{onChange:t,value:r}})=>e.jsx(Y,{leftWidth:77,areaCodes:N,isError:!!i.phoneNumber,value:{areaCode:r.areaCode,phoneNumber:r.phoneNumber},onChange:s=>{t({areaCode:s.areaCode,phoneNumber:s.phoneNumber})}})}),i.phoneNumber&&e.jsx("p",{className:d("absolute left-5 text-[var(--Danger-5)] text-[10px]","ml-[60px] lg:left-5","whitespace-nowrap"),children:i.phoneNumber.message})]}),e.jsxs("div",{className:"relative w-full",children:[e.jsxs("div",{className:"box-border flex flex-row gap-3 items-center justify-start p-0 relative shrink-0 w-full",children:[e.jsx(f,{name:"verificationCode",control:m,rules:{validate:{required:t=>t.length>0||"请填写收到的数字验证码，才能登陆呢～",isNumeric:t=>/^\d+$/.test(t)||"验证码只能是数字哦，去掉字母/符号/空格试试～",length:t=>t.length===6||t.length<6&&`还差${6-t.length}位哦，验证码是6位数字呢～`||t.length>6&&`多输了${t.length-6}位呢，6位数字就够啦～`}},render:({field:t})=>e.jsx(Z,{...t,className:`
                    backdrop-blur-[15px] px-[10px] py-[9px] backdrop-filter basis-0 bg-b5 grow relative rounded-lg shrink-0 border-[1px] h-[42px] text-[16px] text-[var(--b100)] placeholder-[rgba(186,215,245,0.3)]
                    focus-visible:ring-offset-0 focus-visible:ring-0 focus-visible:outline-none
                    transition-all duration-300 ease-in-out
                    ${i.verificationCode?"border-[var(--Danger-5)] shadow-[0_0_0_2px_rgba(255,0,0,0.2)]":"border-b30 focus:border-b100 hover:border-b100 focus:shadow-[0_0_0_2px_rgba(152,255,232,0.2)]"}
                  `,placeholder:U})}),e.jsx(ee,{className:"h-full w-[120px] py-[9px] text-base text-b100",type:"button",onClick:x>0||D?()=>{}:q,children:x>0?`${x}s再获取`:"获取验证码"})]}),i.verificationCode&&e.jsx("p",{className:"absolute text-[var(--Danger-5)] text-[10px] whitespace-nowrap",children:i.verificationCode.message})]}),e.jsx("div",{className:"box-border flex flex-row gap-3 items-center justify-center p-0 relative shrink-0 w-full",children:e.jsx(te,{type:"submit",disabled:j,className:d("basis-0 grow relative shrink-0 rounded-2xl border-[1px] border-transparent","px-[10px] py-[9px] h-[42px] text-[16px] text-center font-bold leading-[22px]","bg-b100 text-[#131a29]","hover:bg-b90 focus:bg-b90 active:bg-b80"),children:j?"绑定中...":"绑定"})}),e.jsxs("div",{className:"relative w-full",children:[e.jsxs("div",{className:"box-border flex flex-row gap-2 items-center justify-start p-0 relative shrink-0 w-full",children:[e.jsx(f,{name:"termsAccepted",control:m,rules:{required:"请阅读并同意服务协议和隐私协议",validate:t=>t===!0||"请阅读并同意服务协议和隐私协议"},render:({field:{onChange:t,value:r}})=>e.jsx(se,{id:g,className:d("size-4 rounded-[4px] border border-solid","transition-all duration-300 ease-in-out",i.termsAccepted?"border-[var(--Danger-5)] shadow-[0_0_0_2px_rgba(255,0,0,0.2)]":"border-b30 focus:border-b100 hover:border-b100 focus:shadow-[0_0_0_2px_rgba(152,255,232,0.2)] hover:shadow-[0_0_0_2px_rgba(152,255,232,0.2)]"),checked:r,onCheckedChange:t})}),e.jsxs("label",{htmlFor:g,className:d("font-normal leading-[20px] relative shrink-0 text-left text-nowrap","text-xs lg:text-sm! text-b100"),children:["我已阅读并同意",e.jsx("span",{className:"text-[var(--Primary-5_)]",children:"《"}),e.jsx(P,{to:"https://gamesirworld.feishu.cn/wiki/QmyNwyxB1iyWzLkyByCcVWWGnDd",target:"_blank",children:e.jsx("span",{className:"underline underline-offset-3 text-[var(--Primary-5_)]",children:"服务协议"})}),e.jsx("span",{className:"text-[var(--Primary-5_)]",children:"》"}),e.jsx("span",{children:"&"}),e.jsx("span",{className:"text-[var(--Primary-5_)]",children:"《"}),e.jsx(P,{to:"https://gamesirworld.feishu.cn/wiki/LlJKwOA8HicXLJktnvecDUxonIc",target:"_blank",className:"[text-decoration-line:underline] [text-decoration-style:solid] [text-underline-position:from-font] font-normal text-[var(--Primary-5_)]",children:e.jsx("span",{className:"underline underline-offset-3 text-[var(--Primary-5_)]",children:"隐私协议"})}),e.jsx("span",{className:"text-[var(--Primary-5_)]",children:"》"})]})]}),i.termsAccepted&&e.jsx("p",{className:"absolute text-[var(--Danger-5)] text-[10px] whitespace-nowrap",children:i.termsAccepted.message})]})]})]})},ge=()=>e.jsxs("div",{className:"fixed top-0 left-0 right-0 bottom-0 z-30 bg-[var(--Background)] w-screen mx-auto h-screen flex items-center justify-center overflow-hidden","data-name":"绑定手机号页面",children:[e.jsx("img",{src:re,alt:"Login Page Logo",className:"absolute top-[38px] left-[29px]"}),e.jsx(ie,{}),e.jsx("div",{className:"absolute inset-0 pointer-events-none shadow-[0px_4px_250px_0px_inset_rgba(9,44,68,0.25)]"}),e.jsx("img",{src:"/images/top-effect.png",alt:"顶部图片",className:"absolute top-0 left-0 right-0  h-[58px] lg:h-[169px]"}),e.jsx("img",{src:"images/bottom-effect.png",alt:"底部图片",className:"absolute bottom-0 left-0 right-0 h-[58px] lg:h-[169px]"})]});export{ge as default};
