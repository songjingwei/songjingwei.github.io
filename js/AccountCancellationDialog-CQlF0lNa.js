import{b as P,r as i,m as I,ao as A,ap as W,j as e,M as $,N as E,O as q,P as H,Q as L,au as Q,a as x,aq as G,ar as J,B as T,as as N,av as K,aE as U,a3 as j}from"./index-CybXJaB_.js";import{C as X}from"./checkbox-DaNQsd72.js";import{T as Y,W as Z}from"./Circle_Warning-CDUc_EXn.js";import{V as ee}from"./index-Bq0sdVVw.js";import{u as se}from"./useCountdown-Dr_XpM1o.js";const te=Q({verificationCode:K().min(1,{message:"请填写收到的数字验证码，才能继续呢～"}).regex(/^\d+$/,{message:"验证码只能是数字哦，去掉字母/符号/空格试试～"}).length(6,{message:"验证码是6位数字哦～"})}),z=({reason:v,children:p,isChecked:l,onCheckedChange:f})=>e.jsx("div",{className:"relative shrink-0 w-full",children:e.jsxs("div",{className:"flex flex-col relative size-full",children:[e.jsx("div",{className:"flex flex-row items-center rounded-[5px] group hover:bg-b30",children:e.jsxs("div",{className:"box-border content-stretch flex flex-row gap-2.5 items-center justify-start px-2.5 py-1.5 relative w-full",children:[e.jsx(X,{className:"relative top-[1px] size-3.5 rounded-[4px] border boder-solid border-b50 data-[state=checked]:bg-[var(--Primary-5)] data-[state=checked]:border-none",checked:l,onCheckedChange:f}),e.jsx("div",{className:"basis-0 flex flex-col grow justify-center leading-[0] min-h-px min-w-px relative shrink-0 text-sm text-left text-b100 group-hover:text-[var(--Primary-5)]",children:e.jsx("p",{className:"block leading-[20px]",children:v})})]})}),l&&p]})}),ae=({onNext:v,onReasonsChange:p,onCancel:l,fullscreen:f})=>{const g=["这是个多余的帐号","担心账户安全风险","不想用盖世游戏了","产品功能问题太多，不好用","找不到我想要的游戏"],[d,b]=i.useState([]),[m,C]=i.useState(!1),[o,w]=i.useState(""),[k,h]=i.useState(!1),y=(s,a)=>{b(c=>a?[...c,s]:c.filter(u=>u!==s))},r=s=>{C(s),s?b(a=>[...a,"其他"]):(b(a=>a.filter(c=>c!=="其他")),w(""),h(!1))},S=s=>{const a=s.target.value;w(a),a.trim()!==""&&h(!1)},R=()=>{m&&o.trim()===""?h(!0):h(!1)},_=()=>{const s=[...d];if(m&&o.trim()){const a=s.indexOf("其他");a!==-1&&(s[a]=o.trim())}p(s),v()},D=d.length===0||m&&o.trim()==="",O=()=>{d.length===0?j.warning("请至少选择一个注销原因"):m&&o.trim()===""?(j.warning("其他原因必填"),h(!0)):_()};return e.jsxs("div",{className:"flex flex-col relative size-full",children:[e.jsx("div",{className:x("flex-grow overflow-auto",f?"mb-[50px] pb-20":"pb-20"),children:e.jsxs("div",{className:"box-border content-stretch flex flex-col gap-6 items-start justify-start p-0 relative shrink-0 w-full",children:[e.jsx("div",{className:"font-['Noto_Sans_SC:Regular',_sans-serif] font-normal leading-[0] relative shrink-0 text-b100 text-sm text-left w-full",children:e.jsx("p",{className:"block leading-[20px]",children:"请选择您注销的原因，以便我们改进产品和服务："})}),e.jsxs("div",{className:x("flex flex-col gap-3 items-start justify-start p-0 relative shrink-0 w-full",f?"":"h-[352px] overflow-y-auto"),children:[g.map(s=>e.jsx(z,{reason:s,isChecked:d.includes(s),onCheckedChange:a=>y(s,!!a)},s)),e.jsx(z,{reason:"其他",isChecked:m,onCheckedChange:s=>r(!!s),children:e.jsx("div",{className:"px-2.5 pb-1.5 w-full mt-1.5",children:e.jsx(Y,{placeholder:"请输入内容",value:o,onChange:S,onBlur:R,className:`backdrop-blur-[15px] backdrop-filter bg-b10 rounded-lg gamesir p-2.5 text-base text-b100 leading-[22px] w-full min-h-[95px] border border-solid border-b20 ${k?"border border-solid border-[var(--Danger-5)]":""}`})})})]})]})}),e.jsxs("div",{className:x("box-border content-stretch flex flex-row items-center justify-between p-0 gap-3 relative shrink-0 w-full",f?"absolute bottom-0 left-0 right-0":""),children:[e.jsx(T,{variant:"gamesir-primary",onClick:l,className:"ml-0 flex-1 w-0 min-w-0",children:"取消"}),e.jsx(N,{onClick:O,className:D?"opacity-50 !cursor-not-allowed mr-0 flex-1 w-0 min-w-0":"mr-0 flex-1 w-0 min-w-0",children:"下一步"})]})]})},ce=({open:v,onOpenChange:p,fullscreen:l=!1})=>{const f=P(),[g,d]=i.useState(1),[b,m]=i.useState(!1),{seconds:C}=se(5,()=>m(!0)),[o,w]=i.useState("phone"),[k,h]=i.useState([]),y=I(t=>t.clear),r=I(t=>t.currentUser),S=i.useMemo(()=>r!=null&&r.mobile?r.mobile.split("-")[0]:"",[r]),R=i.useMemo(()=>r!=null&&r.mobile?r.mobile.split("-")[1]:"",[r]),{control:_,handleSubmit:D,watch:O,formState:{errors:s}}=A({resolver:W(te),defaultValues:{verificationCode:""},mode:"onChange"}),a=O("verificationCode"),c=()=>{p(!1)},u=(t,n)=>e.jsxs("div",{className:"box-border content-stretch flex flex-col gap-1.5 items-start justify-start p-0 relative shrink-0 w-full",children:[e.jsxs("div",{className:"box-border content-stretch flex flex-row gap-2 items-center justify-start p-0 relative shrink-0 w-full",children:[e.jsx("img",{src:Z,alt:"Warning Icon"}),e.jsx("div",{className:"basis-0 font-['Noto_Sans_SC:Bold',_sans-serif] font-bold grow leading-[0] min-h-px min-w-px relative shrink-0 text-[var(--Title)] text-base text-left",children:e.jsx("p",{className:"block leading-[22px]",children:t})})]}),e.jsx("div",{className:"relative shrink-0 w-full",children:e.jsx("div",{className:"flex flex-row items-center justify-center relative size-full",children:e.jsx("div",{className:"box-border content-stretch flex flex-row gap-2.5 items-center justify-center pl-7 pr-0 py-0 relative w-full",children:e.jsx("div",{className:"basis-0 font-['Noto_Sans_SC:Regular',_sans-serif] font-normal grow leading-[0] min-h-px min-w-px relative shrink-0 text-sm text-[var(--text-placeholder)] text-left",children:e.jsx("p",{className:"block leading-[20px]",children:n})})})})})]}),B=(t,n=!1,F)=>e.jsx(N,{selected:n,onClick:F,children:t}),M=()=>{switch(console.log("fullscreen :",l),g){case 1:return e.jsxs("div",{className:"flex flex-col relative size-full",children:[e.jsx("div",{className:x("flex-grow overflow-auto",l?"mb-[50px] pb-20":"pb-20"),children:e.jsxs("div",{className:"box-border content-stretch flex flex-col gap-6 items-start justify-start p-0 relative shrink-0 w-full",children:[e.jsx("div",{className:"font-normal leading-[0] relative shrink-0 text-b100 text-sm text-left w-full",children:e.jsx("p",{className:"block leading-[20px]",children:"特别声明：为了保证您的账号、财产安全，在您申请注销时，稿定设计将进行以下条件验证， 验证通过后，您可以选择注销当前账号，该操作不可逆，请知悉风险！"})}),e.jsxs("div",{className:x("box-border content-stretch flex flex-col gap-3 items-start justify-start p-0 relative shrink-0 w-full",l?"":"h-[352px] overflow-y-auto"),children:[u("会员权益及自动续费","注销账号前, 请确保您作用户无生效的会员时长; 如有自动订阅服务需手动关闭, 请在支付宝/微信支付管理/iTunes商店内等平台解约。"),u("虚拟资产余额","注销账号后, 您作为用户后的云玩时长余额将自动清空, 建议消费后再注销。"),u("个人信息资产","注销账号后, 无法找回或处理该账号的任何内容, 即使使用相同手机号注册也会以新用户身份进行登录。"),u("配置内容管理","注销账号后, 游戏手柄设置/模拟器设置将无法复原，请您在决定注销账号前，充分考虑以上风险，并备份好重要数据，妥善处理账号相关权益。一旦确认注销，相关操作将不可逆转。"),u("配置内容管理","特别声明：为了保证您的账号、财产安全，在您申请注销时，稿定设计将进行以下条件验证， 验证通过后，您可以选择注销当前账号，该操作不可逆，请知悉风险：")]})]})}),e.jsxs("div",{className:x("box-border content-stretch flex flex-row items-center justify-between p-0 gap-3 relative shrink-0 w-full ",l?"absolute bottom-0 left-0 right-0":""),children:[e.jsx(T,{variant:"gamesir-primary",onClick:c,className:"ml-0 flex-1 w-0 min-w-0",children:"取消"}),e.jsx(N,{onClick:()=>d(2),disabled:!b,className:"mr-0 flex-1 w-0 min-w-0",children:b?"下一步":`下一步 (${C})`})]})]});case 2:return e.jsx(ae,{onNext:()=>d(3),onReasonsChange:h,onCancel:c,fullscreen:l});case 3:return e.jsxs("form",{onSubmit:D(V),className:"flex flex-col relative size-full",children:[e.jsx("div",{className:x("flex-grow",l?"pb-20":""),children:e.jsxs("div",{className:"box-border content-stretch flex flex-col items-start justify-start p-0 relative shrink-0 w-full",children:[e.jsx("div",{className:"font-['Noto_Sans_SC:Regular',_sans-serif] font-normal leading-[0] relative shrink-0 text-b100 text-sm text-left w-full",children:e.jsx("p",{className:"block leading-[20px]",children:"特别声明：为了保证您的账号、财产安全，在您申请注销时，稿定设计将进行以下条件验证， 验证通过后，您可以选择注销当前账号，该操作不可逆，请知悉风险！"})}),e.jsx("div",{className:"font-['Noto_Sans_SC:Regular',_sans-serif] font-normal leading-[0] relative shrink-0 text-b100 text-sm text-left w-full mt-4",children:e.jsx("p",{className:"block leading-[20px]",children:"为了保证您的账号安全，需先验证您的身份："})}),e.jsxs("div",{className:"box-border content-stretch flex flex-col gap-4 items-start justify-start mt-4 p-0 relative shrink-0 w-full",children:[e.jsx("div",{className:"box-border content-stretch flex flex-row gap-3 items-start justify-start p-0 relative shrink-0",children:B("手机号验证",o==="phone",()=>w("phone"))}),o==="phone"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-normal leading-[0] min-w-full relative shrink-0 text-b100  text-left",style:{width:"min-content"},children:e.jsxs("p",{className:"leading-[20px] text-sm",children:[e.jsx("span",{children:"您当前的手机号："}),e.jsxs("span",{className:"font-['Noto_Sans_SC:Bold',_sans-serif] font-bold text-[var(--Primary-5)]",children:["+",S," ",G(R)]})]})}),e.jsx("div",{className:"box-border content-stretch flex flex-row gap-3 items-center justify-start p-0 relative shrink-0 w-full -mt-1",children:e.jsx(J,{name:"verificationCode",control:_,render:({field:t})=>{var n;return e.jsx(ee,{...t,verificationCode:t.value,onVerificationCodeChange:t.onChange,scene:"deleted",error:(n=s.verificationCode)==null?void 0:n.message})}})})]})]})]})}),e.jsxs("div",{className:x("box-border content-stretch flex flex-row items-center justify-between p-0 gap-3 relative shrink-0 w-full ",l?"absolute bottom-0 left-0 right-0":""),children:[e.jsx(T,{variant:"gamesir-primary",onClick:c,className:"ml-0 flex-1 w-0 min-w-0",children:"取消"}),e.jsx(N,{type:"submit",disabled:!a||!!s.verificationCode,className:"mr-0 flex-1 w-0 min-w-0",children:"申请注销"})]})]});default:return null}},V=async t=>{try{const n=await U({code:t.verificationCode,deleted_reason:k.join(";")});n.code===200?(y(),j.success("账号已成功注销"),c(),f("/login")):j.error(n.message||"注销申请失败")}catch(n){console.error("注销账号时出错:",n),j.error(`注销账号时发生错误: ${n.message}`)}};return e.jsx($,{open:v,onOpenChange:t=>{p(t),t||d(1)},children:e.jsxs(E,{autoFocus:!1,className:l?"h-full w-full max-w-full rounded-none border-none bg-b10 z-[10000] flex flex-col":"w-[504px]",children:[e.jsxs(q,{children:[e.jsx(H,{className:"text-left md:text-center",children:l?"注销账号":g===1?"注销账号（1/3）":g===2?"请选择您注销的原因（2/3）":"身份验证（3/3）"}),e.jsx(L,{className:"hidden",children:"Multi-step account cancellation dialog"})]}),e.jsx("div",{className:"flex-grow overflow-auto",children:M()})]})})};export{ce as A};
