import{j as e,b as E,i as O,r as p,af as T,a3 as G,ag as z,ah as U}from"./index-CybXJaB_.js";import{A as W}from"./ArrowLeftIcon-udHCKLBD.js";const $="_container_y8me3_1",J="_header_y8me3_17",K="_title_y8me3_24",q="_content_y8me3_33",Q="_inputGroup_y8me3_41",X="_label_y8me3_48",Y="_input_y8me3_41",ee="_textarea_y8me3_83",te="_textareaCount_y8me3_109",ae="_mediaSection_y8me3_118",se="_mediaGrid_y8me3_125",ne="_imgItem_y8me3_132",oe="_imgMask_y8me3_147",ie="_imgActions_y8me3_167",le="_imgActionBtn_y8me3_175",ce="_mediaImage_y8me3_185",re="_mediaVideo_y8me3_192",de="_uploadBox_y8me3_199",me="_uploadIcon_y8me3_221",pe="_uploadText_y8me3_233",ge="_loadingIcon_y8me3_252",ue="_submitSection_y8me3_267",he="_submitBtn_y8me3_277",ve="_hiddenFileInput_y8me3_298",_e="_previewOverlay_y8me3_303",fe="_previewContainer_y8me3_316",xe="_previewCloseButton_y8me3_332",Ce="_previewContent_y8me3_369",ye="_previewImage_y8me3_380",we="_previewVideo_y8me3_388",je="_filePreview_y8me3_398",be="_fileIcon_y8me3_411",Ie="_fileName_y8me3_416",a={container:$,header:J,title:K,content:q,inputGroup:Q,label:X,input:Y,textarea:ee,textareaCount:te,mediaSection:ae,mediaGrid:se,imgItem:ne,imgMask:oe,imgActions:ie,imgActionBtn:le,mediaImage:ce,mediaVideo:re,uploadBox:de,uploadIcon:me,uploadText:pe,loadingIcon:ge,submitSection:ue,submitBtn:he,hiddenFileInput:ve,previewOverlay:_e,previewContainer:fe,previewCloseButton:xe,previewContent:Ce,previewImage:ye,previewVideo:we,filePreview:je,fileIcon:be,fileName:Ie},A=({className:l})=>e.jsx("svg",{className:l,xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M11 21.0005V13.001H3.00049C2.4482 13.001 2 12.5528 2 12.0005C2 11.4482 2.44821 11 3.00049 11H11V3.00049C11 2.4482 11.4482 2 12.0005 2C12.5528 2.00001 13.001 2.44821 13.001 3.00049V11H21.0005C21.5528 11 22.001 11.4482 22.001 12.0005C22.001 12.5528 21.5528 13.001 21.0005 13.001H13.001V21.0005C13.001 21.5528 12.5527 22.001 12.0005 22.001C11.4482 22.001 11 21.5528 11 21.0005Z",fill:"currentColor"})}),Ne=({className:l})=>e.jsxs("svg",{className:l,xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:[e.jsx("g",{clipPath:"url(#paint0_angular_4308_13946_clip_path)",children:e.jsx("g",{transform:"matrix(0 -0.01 0.01 0 12 12)",children:e.jsx("foreignObject",{x:"-1000",y:"-1000",width:"2000",height:"2000",children:e.jsx("div",{style:{background:"conic-gradient(from 90deg,rgba(152, 255, 232, 0) 0deg,rgba(152, 255, 232, 1) 360deg)",height:"100%",width:"100%",opacity:1}})})})}),e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2ZM12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4Z"}),e.jsx("defs",{children:e.jsx("clipPath",{id:"paint0_angular_4308_13946_clip_path",children:e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2ZM12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4Z"})})})]}),L=({className:l})=>e.jsxs("svg",{className:l,xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",children:[e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10.4675 8.00033C10.4675 9.36263 9.36302 10.4671 8.00069 10.4671C6.63841 10.4671 5.53389 9.36261 5.53389 8.00033C5.5339 6.63804 6.63841 5.53355 8.00069 5.53353C9.36302 5.53353 10.4675 6.63803 10.4675 8.00033ZM9.13415 8.00033C9.13415 7.37441 8.62662 6.86686 8.00069 6.86686C7.37479 6.86688 6.86723 7.37442 6.86723 8.00033C6.86723 8.62623 7.37478 9.13377 8.00069 9.13379C8.62662 9.13379 9.13415 8.62625 9.13415 8.00033Z",fill:"#BAD7F5"}),e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8.00069 3.13379C11.0036 3.13379 13.4165 4.95056 14.5189 7.50814L14.6218 7.75814L14.642 7.81673C14.682 7.95653 14.6751 8.10665 14.6218 8.24316C13.5719 10.9313 11.1004 12.8669 8.00069 12.8669C4.901 12.8668 2.42949 10.9313 1.3796 8.24316C1.31874 8.08733 1.31882 7.91399 1.3796 7.75814L1.48246 7.50814C2.5848 4.95055 4.99777 3.13381 8.00069 3.13379ZM8.00069 4.46712C5.59536 4.46714 3.64026 5.90282 2.72204 8.00033C3.64026 10.0979 5.59536 11.5335 8.00069 11.5335C10.4059 11.5335 12.3604 10.0977 13.2787 8.00033C12.3604 5.90295 10.4059 4.46712 8.00069 4.46712Z",fill:"#BAD7F5"})]}),Se=({className:l})=>e.jsx("svg",{className:l,xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",children:e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4 3.9127C4 2.84778 5.18717 2.21261 6.07324 2.80333L12.2041 6.89122C12.9958 7.41898 12.9958 8.5822 12.2041 9.10997L6.07324 13.1969C5.18717 13.7876 4 13.1524 4 12.0875V3.9127ZM5.33301 12.0875L11.4648 8.00059L5.33301 3.9127V12.0875Z",fill:"#BAD7F5"})}),ke=({className:l})=>e.jsxs("svg",{className:l,xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",children:[e.jsx("path",{d:"M6.66699 6.66699C7.03492 6.66717 7.33283 6.96508 7.33301 7.33301V10.667C7.33284 11.0349 7.03492 11.3328 6.66699 11.333C6.29891 11.333 6.00017 11.035 6 10.667V7.33301C6.00018 6.96497 6.29891 6.66699 6.66699 6.66699Z",fill:"#BAD7F5"}),e.jsx("path",{d:"M8.66699 10.667V7.33301C8.66717 6.96508 8.96508 6.66717 9.33301 6.66699C9.70108 6.66699 9.99982 6.96497 10 7.33301V10.667C9.99983 11.035 9.70109 11.333 9.33301 11.333C8.96507 11.3328 8.66716 11.0349 8.66699 10.667Z",fill:"#BAD7F5"}),e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9.14258 1.33301C9.63319 1.33301 10.0971 1.53829 10.4336 1.8916C10.7691 2.24389 10.9521 2.71534 10.9521 3.2002V4H13.333C13.7012 4 14 4.2988 14 4.66699C13.9998 5.03503 13.7011 5.33301 13.333 5.33301H13.2812L12.6641 12.8545C12.6509 13.32 12.4713 13.7694 12.1484 14.1084C11.812 14.4617 11.348 14.6669 10.8574 14.667H5.14258C4.65198 14.6669 4.18806 14.4617 3.85156 14.1084C3.52873 13.7694 3.34913 13.32 3.33594 12.8545L2.71875 5.33301H2.66699C2.29891 5.33301 2.00017 5.03503 2 4.66699C2 4.2988 2.2988 4 2.66699 4H5.04785V3.2002C5.04785 2.71534 5.2309 2.24389 5.56641 1.8916C5.90296 1.53829 6.36678 1.33301 6.85742 1.33301H9.14258ZM4.66406 12.7451C4.66554 12.7632 4.66699 12.7817 4.66699 12.7998C4.66699 12.9514 4.72434 13.0907 4.81738 13.1885C4.9094 13.2851 5.02716 13.3329 5.14258 13.333H10.8574C10.9729 13.3329 11.0906 13.2851 11.1826 13.1885C11.2756 13.0907 11.333 12.9514 11.333 12.7998C11.333 12.7817 11.3345 12.7632 11.3359 12.7451L11.9434 5.33301H4.05664L4.66406 12.7451ZM6.85742 2.66699C6.74195 2.66699 6.62431 2.71488 6.53223 2.81152C6.43908 2.90933 6.38086 3.04854 6.38086 3.2002V4H9.61914V3.2002C9.61914 3.04854 9.56097 2.90933 9.46777 2.81152C9.37572 2.71488 9.25806 2.66699 9.14258 2.66699H6.85742Z",fill:"#BAD7F5"})]}),Ve=()=>{const l=E(),[M]=O(),I=p.useRef(null);p.useEffect(()=>{const t=()=>{window.innerWidth>1e3&&l("/")};return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[l]);const[f,x]=p.useState(""),[h,C]=p.useState(""),[y,v]=p.useState([]),[N,g]=p.useState([]),[w,S]=p.useState(null),[V,F]=p.useState(!1),[u,j]=p.useState({});p.useEffect(()=>{const t=M.get("action");if(t==="saveDraft"){const o=localStorage.getItem("feedback_contact"),r=localStorage.getItem("feedback_desc"),s=localStorage.getItem("feedback_images");if(o&&x(o),r&&C(r),s)try{v(JSON.parse(s))}catch{console.error("Failed to parse saved images")}}else(t==="retry"||t==="tryLater")&&(x(""),C(""),v([]),localStorage.removeItem("feedback_contact"),localStorage.removeItem("feedback_desc"),localStorage.removeItem("feedback_images"))},[M]);const D=()=>{I.current&&I.current.click()},R=async t=>{const o=t.target.files;if(o&&o.length>0){const r=Array.from(o);if(y.length+N.length+r.length>2){G.error("æœ€å¤šåªèƒ½ä¸Šä¼ 2ä¸ªæ–‡ä»¶"),t.target.value="";return}r.forEach(async s=>{var _;const n=`${Date.now()}-${Math.random()}`,m=s.type.startsWith("video/"),k=s.type.startsWith("image/"),b=!m&&!k;g(i=>[...i,{id:n,fileName:s.name,progress:0}]);try{const i=await z(s,c=>{g(d=>d.map(B=>B.id===n?{...B,progress:c}:B))});i.code===200&&((_=i.data)!=null&&_.url)?(g(c=>c.filter(d=>d.id!==n)),v(c=>[...c,{url:i.data.url,displayUrl:i.data.url,type:m?"video":k?"image":"file",fileName:b?s.name:void 0}])):(console.error("æ–‡ä»¶ä¸Šä¼ å¤±è´¥:",i.message),g(c=>c.map(d=>d.id===n?{...d,error:i.message||"æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡è¯•"}:d)))}catch(i){console.error("æ–‡ä»¶ä¸Šä¼ å¼‚å¸¸:",i),g(c=>c.map(d=>d.id===n?{...d,error:(i==null?void 0:i.message)||"æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥"}:d))}}),t.target.value=""}},Z=t=>{v(o=>o.filter((r,s)=>s!==t))},H=t=>{t.type==="file"?window.open(t.url,"_blank"):S({url:t.displayUrl,type:t.type,fileName:t.fileName})},P=async()=>{var o,r;j({});const t={};if(f.trim()||(t.contact="è¯·å¡«å†™æ‰‹æœºå·/é‚®ç®±"),h.trim()||(t.content="è¯·å¡«å†™é—®é¢˜æè¿°"),Object.keys(t).length>0){j(t);return}F(!0);try{const s={contact:f.trim(),content:h.trim(),attachment:y.map(m=>({type:m.type,url:m.url})),filter:{labels:{"platform-WebLabel":"true"}}};console.log("æ‰‹æœºç«¯æäº¤åé¦ˆ:",s);const n=await U(s);if(n.code===200){console.log("æ‰‹æœºç«¯åé¦ˆæäº¤æˆåŠŸ:",n);const m=localStorage.getItem("token"),b=`userFeedbacks_${m?m.substring(0,10):"anonymous"}`,_=JSON.parse(localStorage.getItem(b)||"[]"),i=n.data?{id:n.data.id,contact:n.data.contact,content:n.data.content,created_at:n.data.created_at,updated_at:n.data.updated_at,read:n.data.read,attachment:n.data.attachment}:{id:Date.now(),contact:f.trim(),content:h.trim(),created_at:Math.floor(Date.now()/1e3),updated_at:Math.floor(Date.now()/1e3),read:1,attachment:y.map(c=>({type:c.type,url:c.url}))};_.unshift(i),localStorage.setItem(b,JSON.stringify(_)),console.log("æ‰‹æœºç«¯åé¦ˆå·²ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨:",i),x(""),C(""),v([]),localStorage.removeItem("feedback_contact"),localStorage.removeItem("feedback_desc"),localStorage.removeItem("feedback_images"),l("/mobile-settings/help/feedback/success",{state:{message:n.message||"ä½ çš„åé¦ˆå·²æäº¤,æœ‰è¿›å±•ä¼šé€šè¿‡æ¶ˆæ¯é€šçŸ¥ä½ å“¦~",data:n.data}})}}catch(s){console.error("æ‰‹æœºç«¯åé¦ˆæäº¤å¤±è´¥:",s);const n="network",m=((r=(o=s==null?void 0:s.response)==null?void 0:o.data)==null?void 0:r.message)||(s==null?void 0:s.message)||"æäº¤å¤±è´¥,è¯·ç¨åé‡è¯•~";l("/mobile-settings/help/feedback/fail",{state:{type:n,message:m,error:s}})}finally{F(!1)}};return e.jsxs("div",{className:a.container,children:[e.jsx("div",{className:a.header,children:e.jsx("span",{className:a.title,children:"æäº¤åé¦ˆæ„è§"})}),e.jsxs("div",{className:a.content,children:[e.jsxs("div",{className:a.inputGroup,children:[e.jsxs("label",{className:a.label,children:["æ‰‹æœºå·/é‚®ç®±",e.jsx("span",{style:{color:"#ff4d4f",marginLeft:"2px"},children:"*"})]}),e.jsx("input",{className:a.input,type:"text",value:f,onChange:t=>{x(t.target.value),u.contact&&j(o=>({...o,contact:void 0}))},placeholder:"è¯·è¾“å…¥æ‚¨çš„æ‰‹æœºå·/é‚®ç®±æ–¹ä¾¿æˆ‘ä»¬è”ç³»åˆ°æ‚¨"}),u.contact&&e.jsx("div",{style:{color:"#ff4757",fontSize:"12px",marginTop:"4px"},children:u.contact})]}),e.jsxs("div",{className:a.inputGroup,children:[e.jsxs("label",{className:a.label,children:["é—®é¢˜æè¿°",e.jsx("span",{style:{color:"#ff4d4f",marginLeft:"2px"},children:"*"})]}),e.jsx("textarea",{className:a.textarea,value:h,onChange:t=>{C(t.target.value),u.content&&j(o=>({...o,content:void 0}))},placeholder:`è¯·å…·ä½“æè¿°æ‚¨çš„é—®é¢˜:
1.è¯¦ç»†çš„æ“ä½œæ­¥éª¤
2.æ“ä½œä¸­é‡åˆ°äº†ä»€ä¹ˆé—®é¢˜?ä»¥åŠæ‚¨çš„æƒ³æ³•å’Œå»ºè®®`,maxLength:500}),u.content&&e.jsx("div",{style:{color:"#ff4757",fontSize:"12px",marginTop:"4px"},children:u.content}),e.jsxs("div",{className:a.textareaCount,children:[h.length,"/500"]})]}),e.jsxs("div",{className:a.mediaSection,children:[e.jsx("label",{className:a.label,children:"é—®é¢˜æˆªå›¾/å½•é¢‘/æ–‡ä»¶"}),e.jsxs("div",{className:a.mediaGrid,children:[y.map((t,o)=>e.jsxs("div",{className:a.imgItem,children:[t.type==="image"?e.jsx("img",{src:t.displayUrl,alt:"å·²ä¸Šä¼ ",className:a.mediaImage}):t.type==="video"?e.jsx("video",{src:t.displayUrl,className:a.mediaVideo,controls:!1}):e.jsxs("div",{className:a.filePreview,children:[e.jsx("div",{className:a.fileIcon,children:"ğŸ“„"}),e.jsx("div",{className:a.fileName,children:t.fileName||"æ–‡ä»¶"})]}),e.jsx("div",{className:a.imgMask,children:e.jsxs("div",{className:a.imgActions,children:[e.jsx("button",{className:a.imgActionBtn,onClick:()=>H(t),children:t.type==="image"?e.jsx(L,{}):t.type==="video"?e.jsx(Se,{}):e.jsx(L,{})}),e.jsx("button",{className:a.imgActionBtn,onClick:()=>Z(o),children:e.jsx(ke,{})})]})})]},o)),N.map(t=>e.jsxs("div",{style:{position:"relative"},children:[e.jsxs("div",{className:a.uploadBox,onClick:t.error?()=>g(o=>o.filter(r=>r.id!==t.id)):void 0,style:{cursor:t.error?"pointer":"default"},children:[e.jsx("div",{className:a.uploadIcon,style:t.error?{transform:"rotate(45deg)"}:void 0,children:t.error?e.jsx(A,{}):e.jsx(Ne,{className:a.loadingIcon})}),e.jsx("span",{className:a.uploadText,children:t.error?"ä¸Šä¼ å¤±è´¥":`ä¸Šä¼ ä¸­${t.progress??0}%`})]}),t.error&&e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",marginTop:"5px",color:"var(--Danger-Danger-5, #FF614C)",fontFamily:'"Noto Sans SC"',fontSize:"10px",fontStyle:"normal",fontWeight:400,lineHeight:"14px"},children:t.error})]},t.id)),e.jsxs("div",{className:a.uploadBox,onClick:D,children:[e.jsx("div",{className:a.uploadIcon,children:e.jsx(A,{})}),e.jsx("span",{className:a.uploadText,children:"ä¸Šä¼ æ–‡ä»¶"}),e.jsx("input",{ref:I,type:"file",accept:".jpg,.jpeg,.png,.gif,.svg,.webp,.bmp,.mp4,.avi,.mov,.wmv,.flv,.webm,.mkv,.pdf,.xlsx,.xls,.doc,.docx",multiple:!0,className:a.hiddenFileInput,onChange:R})]})]})]}),w&&T.createPortal(e.jsx("div",{className:a.previewOverlay,onClick:()=>S(null),children:e.jsxs("div",{className:a.previewContainer,onClick:t=>t.stopPropagation(),children:[e.jsx("div",{className:a.previewCloseButton,onClick:()=>S(null),children:e.jsx(W,{})}),e.jsx("div",{className:a.previewContent,children:w.type==="image"?e.jsx("img",{src:w.url,alt:"é¢„è§ˆ",className:a.previewImage}):e.jsx("video",{src:w.url,controls:!0,autoPlay:!0,className:a.previewVideo})})]})}),document.body)]}),e.jsx("div",{className:a.submitSection,children:e.jsx("button",{className:a.submitBtn,onClick:P,disabled:V||N.some(t=>!t.error),children:V?"æäº¤ä¸­...":"æäº¤"})})]})};export{Ve as default};
