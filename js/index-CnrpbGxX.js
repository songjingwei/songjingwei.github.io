import{o as ee,aK as te,r as n,j as e,a as i,b as se,an as re,m as ae,ao as oe,aL as ne,Z as ie,ar as j,aM as le,at as ce,as as de,B as pe,k as T,aw as xe,X as me,aN as ge,aO as ue,a3 as _}from"./index-CybXJaB_.js";import{L as fe}from"./login-logo-Bs7gJD3W.js";import{C as he}from"./checkbox-DaNQsd72.js";import{G as be,Q as _e}from"./GoogleIcon-CgfYqzML.js";import{S as ve}from"./SteamIcon-CWf_uew3.js";import{u as we}from"./useVerifyCodeMutation-yTHkI_Sq.js";import{u as Ne}from"./useProvidersQuery-D_r0QIrS.js";import{u as je}from"./useAreaCodes-D6g38FIU.js";const ye=()=>ee({mutationFn:async o=>(await te(o)).data,onSuccess:o=>{console.log("登录成功！",o)},onError:o=>{console.error("登录失败：",o)}}),Ce={"gamesir-glass":"_gamesir-glass_15bhj_1"},V=n.forwardRef(({className:o,children:x,...v},g)=>e.jsx("div",{ref:g,className:i("relative overflow-hidden","rounded-2xl","backdrop-blur-[15px] backdrop-filter","bg-b5 hover:bg-b10","shadow-[0px_5px_12px_4px_rgba(0,0,0,0.05),0px_3px_6px_0px_rgba(0,0,0,0.08),0px_1px_2px_-2px_rgba(0,0,0,0.12)]","cursor-pointer",Ce["gamesir-glass"],o),...v,children:x}));V.displayName="GlassContainer";const ke="_loginForm_b1k1a_2",z={loginForm:ke},Se={wechatweb:{icon:xe,path:"wechat",label:"微信登录"},qq:{icon:_e,path:"qq",label:"QQ登录"},google:{icon:be,path:"google",label:"Google登录"},steam:{icon:ve,path:"steam",label:"Steam登录"}},Le=()=>{const o=se(),x=re(),{login:v}=ae(),g=n.useId(),y=je().map(t=>({name:t.name,code:t.code.replace("+","")})),{data:u,isLoading:Ee}=Ne("cn");console.log("providers",u);const{control:f,handleSubmit:W,trigger:G,getValues:C,setValue:M,setError:H,formState:{errors:l}}=oe({mode:"all",defaultValues:{phoneNumber:{areaCode:y[0].code,phoneNumber:""},verificationCode:"",termsAccepted:!1}}),{errors:q}=ne({control:f}),{mutate:O,isPending:Q}=we(),{mutate:U,isPending:k}=ye(),[S,L]=n.useState(!1),[m,P]=n.useState(0),[$,K]=n.useState(!1),[X,E]=n.useState("输入短信中的验证码"),[I,w]=n.useState(0),R=n.useRef(null);n.useEffect(()=>{let t;return m>0&&(t=setInterval(()=>{P(s=>s-1)},1e3)),()=>clearInterval(t)},[m]),n.useEffect(()=>{const t=()=>{const a=document.createElement("canvas").getContext("2d");if(!a)return;a.font="14px system-ui, -apple-system, sans-serif";const c="输入短信中的验证码",N="输入验证码",A=a.measureText(c).width,d=110,p=window.innerWidth<768?d:d+50;A>p?E(N):E(c)};t();const s=()=>{t()};return window.addEventListener("resize",s),()=>{window.removeEventListener("resize",s)}},[]),n.useEffect(()=>{const t=()=>{const a=document.querySelector('img[alt="Login Page Logo"]'),c=R.current;if(!a||!c){w(0);return}const N=a.getBoundingClientRect(),d=c.getBoundingClientRect().top,h=N.bottom,p=d-h,D=window.innerHeight;let b=40;if(D<800&&(b=50),p<b){const B=b-p,F=Math.max(B,30);console.log("Logo overlap detected, adjusting:",{screenHeight:D,safeDistance:b,logoBottom:h,formTop:d,currentDistance:p,needToMove:B,adjustedMargin:F}),w(F)}else console.log("Safe distance maintained:",{logoBottom:h,formTop:d,currentDistance:p}),w(0)},s=setTimeout(t,100),r=()=>{setTimeout(t,50)};return window.addEventListener("resize",r),window.addEventListener("scroll",t),()=>{clearTimeout(s),window.removeEventListener("resize",r),window.removeEventListener("scroll",t)}},[]);const J=()=>{P(60)},Y=async()=>{var s;K(!0),await G("phoneNumber")?O({scene:"login",target:C("phoneNumber.phoneNumber"),type:"sms",zone_code:C("phoneNumber.areaCode")},{onSuccess:r=>{J(),r.data&&M("verificationCode",r.data)},onError:r=>{console.error("发送验证码失败：",r.message),_.error(r.message)}}):console.log("手机号校验失败",(s=q.phoneNumber)==null?void 0:s.message)},Z=t=>{U({type:"sms",username:t.phoneNumber.phoneNumber,code:t.verificationCode,zone_code:t.phoneNumber.areaCode},{onSuccess:async s=>{_.success("登录成功！"),L(!0),await v(s.data);const a=new URLSearchParams(x.search).get("redirect");sessionStorage.removeItem("navigationHistory"),sessionStorage.setItem("fromLogin","true"),o(a?decodeURIComponent(a):"/explore")},onError:s=>{L(!1),s instanceof Error?_.error(s.message):s.code===400&&s.message.includes("验证码无效")?H("verificationCode",{type:"manual",message:$?"验证码过期啦，请重新获取新的验证码吧～":"验证码不对呢，再看看短信里的数字～"}):(console.error("登录失败:",s),_.error(s.message))}})};return e.jsxs("div",{ref:R,className:"flex flex-col items-center gap-5 lg:min-w-[400px]",style:{marginTop:I>0?`${I}px`:"0"},children:[e.jsxs("form",{onSubmit:W(Z),className:i("relative box-border flex flex-col items-center justify-start z-20","p-4 min-[500px]:p-7 lg:p-9","w-[91%] lg:w-full max-w-[400px]","gap-5 min-[500px]:gap-7 lg:gap-9 rounded-2xl","min-[360px]:backdrop-blur-[5px] min-[360px]:backdrop-filter","min-[360px]:bg-b5","min-[360px]:shadow-[0px_5px_12px_4px_rgba(0,0,0,0.05),0px_3px_6px_0px_rgba(0,0,0,0.08),0px_1px_2px_-2px_rgba(0,0,0,0.12)]"),children:[e.jsx("div",{className:i(z.loginForm,"absolute inset-0","rounded-2xl","pointer-events-none","bg-clip-padding","min-[360px]:bg-b5","min-[360px]:shadow-[0px_5px_12px_4px_rgba(0,0,0,0.05),0px_3px_6px_0px_rgba(0,0,0,0.08),0px_1px_2px_-2px_rgba(0,0,0,0.12)]")}),e.jsx("div",{className:"hidden min-[360px]:block w-[110px] h-[88px] blur-[82px] bg-[var(--Primary-5)] absolute -top-1.5 left-1/2 -translate-x-1/2 opacity-40 will-change-[filter]"}),e.jsxs("div",{className:"box-border flex flex-col gap-6 items-start justify-start p-0 relative shrink-0 w-full",children:[e.jsxs("div",{className:"box-border flex flex-col gap-3 items-start justify-start p-0 relative shrink-0 w-full",children:[e.jsx("div",{className:"box-border flex flex-row gap-2.5 items-start justify-end p-0 relative shrink-0 w-full",children:e.jsx("div",{className:"basis-0 font-bold grow leading-[28px] text-[#dfefff] text-[20px] text-left",children:e.jsx("p",{children:"手机号登录 / 注册"})})}),e.jsx("div",{className:"font-normal leading-[20px] relative shrink-0 text-[#bad7f5] text-[14px] text-left w-full",children:e.jsx("p",{children:ie.firstRegisterTip})})]}),e.jsxs("div",{className:"relative w-full",children:[e.jsx(j,{name:"phoneNumber",control:f,rules:{validate:{required:t=>t.phoneNumber.length>0||"手机号码不能为空",isNumeric:t=>/^\d+$/.test(t.phoneNumber)||"检测到非数字字符啦，试试只输入 11 位数字吧！",length:t=>t.phoneNumber.length===11||"请检查手机号码格式，国内手机号应为 11 位数字哦～"}},render:({field:{onChange:t,value:s}})=>e.jsx(le,{leftWidth:79,areaCodes:y,isError:!!l.phoneNumber,value:{areaCode:s.areaCode,phoneNumber:s.phoneNumber},onChange:r=>{t({areaCode:r.areaCode,phoneNumber:r.phoneNumber})}})}),l.phoneNumber&&e.jsx("p",{className:i("absolute left-5 text-[var(--Danger-5)] text-[10px]","ml-[60px] lg:left-5","whitespace-nowrap"),children:l.phoneNumber.message})]}),e.jsxs("div",{className:"relative w-full",children:[e.jsxs("div",{className:"box-border flex flex-row gap-3 items-center justify-start p-0 relative shrink-0 w-full",children:[e.jsx(j,{name:"verificationCode",control:f,rules:{validate:{required:t=>t.length>0||"请填写收到的数字验证码，才能登陆呢～",isNumeric:t=>/^\d+$/.test(t)||"验证码只能是数字哦，去掉字母/符号/空格试试～",length:t=>t.length===6||t.length<6&&`还差${6-t.length}位哦，验证码是6位数字呢～`||t.length>6&&`多输了${t.length-6}位呢，6位数字就够啦～`}},render:({field:t})=>e.jsx(ce,{...t,style:{fontSize:"14px",lineHeight:"20px"},className:i("h-[42px]","text-base text-b100","px-[10px] py-[9px]","basis-0 grow relative shrink-0 rounded-lg border-[1px]","backdrop-blur-[15px] backdrop-filter bg-b5","focus-visible:ring-offset-0 focus-visible:ring-0 focus-visible:outline-none","transition-all duration-300 ease-in-out",l.verificationCode?"border-[var(--Danger-5)] shadow-[0_0_0_2px_rgba(255,0,0,0.2)]":"border-b30 focus:border-b100 hover:border-b100 focus:shadow-[0_0_0_2px_rgba(186,215,245,0.2)]"),placeholder:X})}),e.jsx(de,{type:"button",className:i(z.verifyCodeButton,"h-[42px] w-[120px] py-[9px] text-base text-[var(--b100)]"),style:{fontSize:"14px",lineHeight:"20px"},onClick:m>0||Q?()=>{}:Y,children:m>0?`${m}s再获取`:"获取验证码"})]}),l.verificationCode&&e.jsx("p",{className:"absolute text-[var(--Danger-5)] text-[10px] whitespace-nowrap",children:l.verificationCode.message})]}),e.jsx("div",{className:"box-border flex flex-row gap-3 items-center justify-center p-0 relative shrink-0 w-full",children:e.jsx(pe,{type:"submit",disabled:k||S,className:i("basis-0 grow relative shrink-0 rounded-2xl border-[1px] border-transparent","px-[10px] py-[9px] h-[42px] text-[14px] lg:text-[16px] text-center font-bold leading-[22px]","bg-b100 text-[#131a29]","hover:bg-b90 focus:bg-b90 active:bg-b80"),children:k||S?"登录中...":"登录"})}),e.jsxs("div",{className:"relative w-full",children:[e.jsxs("div",{className:"box-border flex flex-row gap-2 items-center justify-start p-0 relative shrink-0 w-full",children:[e.jsx(j,{name:"termsAccepted",control:f,rules:{required:"请阅读并同意服务协议和隐私协议",validate:t=>t===!0||"请阅读并同意服务协议和隐私协议"},render:({field:{onChange:t,value:s}})=>e.jsx(he,{id:g,className:i("size-4 rounded-[4px] border border-solid","transition-all duration-300 ease-in-out",l.termsAccepted?"border-[var(--Danger-5)] shadow-[0_0_0_2px_rgba(255,0,0,0.2)]":"border-b30 focus:border-b100 hover:border-b100 focus:shadow-[0_0_0_2px_rgba(152,255,232,0.2)] hover:shadow-[0_0_0_2px_rgba(152,255,232,0.2)]"),checked:s,onCheckedChange:t})}),e.jsxs("label",{htmlFor:g,className:i("font-normal leading-[20px] relative shrink-0 text-left text-nowrap","text-xs lg:text-sm! text-[var(--b100)]"),children:["我已阅读并同意",e.jsx("span",{className:"text-[var(--Primary-5_)]",children:"《"}),e.jsx(T,{to:"https://gamesirworld.feishu.cn/wiki/QmyNwyxB1iyWzLkyByCcVWWGnDd",target:"_blank",children:e.jsx("span",{className:"underline underline-offset-3 text-[var(--Primary-5_)]",children:"服务协议"})}),e.jsx("span",{className:"text-[var(--Primary-5_)]",children:"》"}),e.jsx("span",{children:"&"}),e.jsx("span",{className:"text-[var(--Primary-5_)]",children:"《"}),e.jsx(T,{to:"https://gamesirworld.feishu.cn/wiki/LlJKwOA8HicXLJktnvecDUxonIc",target:"_blank",className:"[text-decoration-line:underline] [text-decoration-style:solid] [text-underline-position:from-font] font-normal text-[var(--Primary-5_)]",children:e.jsx("span",{className:"underline underline-offset-3 text-[var(--Primary-5_)]",children:"隐私协议"})}),e.jsx("span",{className:"text-[var(--Primary-5_)]",children:"》"})]})]}),l.termsAccepted&&e.jsx("p",{className:"absolute text-[var(--Danger-5)] text-[10px] whitespace-nowrap",children:l.termsAccepted.message})]})]}),e.jsxs("div",{className:"box-border flex flex-col gap-3 items-center justify-start p-0 relative shrink-0 w-full",children:[e.jsx("div",{className:"font-['Noto_Sans_SC:Regular',_sans-serif] font-normal leading-[20px] relative shrink-0 text-[14px] text-[rgba(186,215,245,0.65)] text-center w-full",children:e.jsx("p",{children:"— 第三方登录 —"})}),e.jsx("div",{className:"box-border flex flex-row gap-3 items-center justify-center p-0 relative shrink-0 w-full",children:u==null?void 0:u.map(t=>{const s=Se[t.provider],r=s==null?void 0:s.icon;return e.jsx(V,{className:"flex-1 h-[42px] text-center",onClick:a=>{a.preventDefault(),a.stopPropagation(),me(s==null?void 0:s.path)},"aria-label":s==null?void 0:s.label,children:e.jsx("div",{className:"flex justify-center items-center w-full h-full",children:e.jsx(r,{className:"text-[20px] color-b100"})})},t.provider)})})]})]}),e.jsx("button",{type:"button",className:i("text-[#b2fcff] text-sm underline underline-offset-2","w-full text-center","cursor-pointer z-10"),onClick:()=>{localStorage.setItem(ge.HAS_SKIPPED_LOGIN,"true"),sessionStorage.removeItem("navigationHistory"),sessionStorage.setItem("fromLogin","true");const s=new URLSearchParams(x.search).get("redirect");if(s){const r=decodeURIComponent(s),a=ue.some(c=>r.startsWith(c));o(a?"/explore":r)}else o("/explore")},children:"暂时跳过登录"})]})},Ve=()=>e.jsxs("div",{className:i("relative","w-screen h-screen mx-auto","flex items-center justify-center","z-30","overflow-y-auto","bg-[var(--Background)]","px-0 min-[360px]:px-5","py-24 lg:py-0"),"data-name":"登陆页面",children:[e.jsx("img",{src:fe,alt:"Login Page Logo",className:"absolute top-[38px] left-[29px]"}),e.jsx(Le,{}),e.jsx("div",{className:"absolute inset-0 pointer-events-none shadow-[0px_4px_250px_0px_inset_rgba(9,44,68,0.25)]"}),e.jsxs("div",{className:"absolute left-0 top-0 w-full h-[58px] lg:h-[169px] overflow-hidden",children:[e.jsx("div",{className:"absolute left-0 top-0 w-full h-[58px] opacity-20 lg:h-[169px] [background:radial-gradient(71.28%_50%_at_50%_0%,#BAD7F5_0%,rgba(9,44,68,0.3)_75%,rgba(9,44,68,0)_100%)]"}),e.jsx("div",{className:"absolute left-0 -top-24 opacity-25  w-full h-[58px] rotate-180 lg:h-[169px] [background:linear-gradient(to_bottom_right,#BAD7F5_0%,rgba(9,44,68,0)_50%)_bottom_right/50%_50%_no-repeat,linear-gradient(to_bottom_left,#BAD7F5_0%,rgba(9,44,68,0)_50%)_bottom_left/50%_50%_no-repeat,linear-gradient(to_top_left,#BAD7F5_0%,rgba(9,44,68,0)_50%)_top_left/50%_50%_no-repeat,linear-gradient(to_top_right,#BAD7F5_0%,rgba(9,44,68,0)_50%)_top_right/50%_50%_no-repeat]"}),e.jsx("img",{className:"w-full h-[58px] lg:h-[169px]",src:"/images/top-effect.png",alt:"顶部图片"})]}),e.jsxs("div",{className:"absolute right-0 bottom-0 w-full h-[58px] lg:h-[169px] overflow-hidden",children:[e.jsx("div",{className:"absolute right-0 bottom-0 w-full h-[58px] rotate-180 opacity-20 lg:h-[169px] [background:radial-gradient(71.28%_50%_at_50%_0%,#BAD7F5_0%,rgba(9,44,68,0.3)_75%,rgba(9,44,68,0)_100%)]"}),e.jsx("div",{className:"absolute right-0 -bottom-24 opacity-25 w-full h-[58px] lg:h-[169px] [background:linear-gradient(to_bottom_right,#BAD7F5_0%,rgba(9,44,68,0)_50%)_bottom_right/50%_50%_no-repeat,linear-gradient(to_bottom_left,#BAD7F5_0%,rgba(9,44,68,0)_50%)_bottom_left/50%_50%_no-repeat,linear-gradient(to_top_left,#BAD7F5_0%,rgba(9,44,68,0)_50%)_top_left/50%_50%_no-repeat,linear-gradient(to_top_right,#BAD7F5_0%,rgba(9,44,68,0)_50%)_top_right/50%_50%_no-repeat]"}),e.jsx("img",{className:"w-full h-[58px] lg:h-[169px] z-50",src:"/images/bottom-effect.png",alt:"底部图片"})]})]});export{Ve as default};
