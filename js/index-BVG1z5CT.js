import{j as e,r as n,b as le,m as K,d as he,V as fe,W as xe,X as ge,Y as Ie,Z as _e,$ as pe,D as Ce,a0 as Me,a1 as be,w as ke,a2 as Ae,a3 as ie,a4 as ve,h as je,R as $e,u as Fe}from"./index-CybXJaB_.js";import{G as de}from"./index-Bu_EVvPV.js";import{F as ce,E as ye,S as me,M as ue}from"./MobileSortIcon-DJ-y8ayd.js";import{L as Se}from"./index-ZhyiOdCU.js";import{g as Te}from"./userLibrary-ClaISK0W.js";import{C as ne}from"./ContainerSkeleton-B-oo09NS.js";import"./HeartIcon-B-fRnsR9.js";import"./index-oH4-aH7I.js";import"./index-BNj5bqZy.js";import"./PLATFORM_ICON_MAP-pSA7Oz_G.js";const Ee="_container_s4xgg_1",He="_title_s4xgg_9",Ge="_mainBox_s4xgg_19",Re="_skeletonBox_s4xgg_26",Ve="_userBoxContainer_s4xgg_63",De="_bottomBox_s4xgg_127",Oe="_steamInfoContainer_s4xgg_145",Pe="_steamInfo_s4xgg_145",We="_steamLabel_s4xgg_157",ze="_steamValue_s4xgg_166",Ze="_copyIcon_s4xgg_175",Ue="_actionButtons_s4xgg_180",qe="_refreshInfo_s4xgg_186",Je="_disabled_s4xgg_194",Xe="_refreshText_s4xgg_199",Ye="_refreshIcon_s4xgg_208",Ke="_rotating_s4xgg_214",Qe="_switchAccount_s4xgg_227",et="_switchText_s4xgg_234",tt="_copySuccessTip_s4xgg_243",st="_userInfoBox_s4xgg_277",at="_userAvatar_s4xgg_283",nt="_userTextInfo_s4xgg_290",rt="_userName_s4xgg_296",ot="_userSignature_s4xgg_306",it="_secondBox_s4xgg_317",lt="_infoTable_s4xgg_322",ct="_tableColumn_s4xgg_327",dt="_tableHeader_s4xgg_333",mt="_tableCell_s4xgg_342",ut="_thirdBox_s4xgg_352",ht="_leftSection_s4xgg_357",ft="_rightSection_s4xgg_358",xt="_valueLabel_s4xgg_365",gt="_playtimeLabel_s4xgg_366",_t="_textBlock_s4xgg_384",pt="_valueAmount_s4xgg_390",Ct="_playtimeValue_s4xgg_391",bt="_miniChart_s4xgg_401",vt="_chartBarContainer_s4xgg_409",jt="_tooltipContainer_s4xgg_415",yt="_chartBar_s4xgg_409",d={container:Ee,title:He,mainBox:Ge,skeletonBox:Re,userBoxContainer:Ve,bottomBox:De,steamInfoContainer:Oe,steamInfo:Pe,steamLabel:We,steamValue:ze,copyIcon:Ze,actionButtons:Ue,refreshInfo:qe,disabled:Je,refreshText:Xe,refreshIcon:Ye,rotating:Ke,switchAccount:Qe,switchText:et,copySuccessTip:tt,userInfoBox:st,userAvatar:at,userTextInfo:nt,userName:rt,userSignature:ot,secondBox:it,infoTable:lt,tableColumn:ct,tableHeader:dt,tableCell:mt,thirdBox:ut,leftSection:ht,rightSection:ft,valueLabel:xt,playtimeLabel:gt,textBlock:_t,valueAmount:pt,playtimeValue:Ct,miniChart:bt,chartBarContainer:vt,tooltipContainer:jt,chartBar:yt},we=({className:i,style:s})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",className:i,style:s,children:[e.jsx("path",{d:"M5.5 8V6C5.5 5.72386 5.72386 5.5 6 5.5C6.27614 5.5 6.5 5.72386 6.5 6V8C6.5 8.27614 6.27614 8.5 6 8.5C5.72386 8.5 5.5 8.27614 5.5 8Z",fill:"#BAD7F5",fillOpacity:"0.65"}),e.jsx("path",{d:"M6 3.25C6.41422 3.25 6.75 3.58579 6.75 4C6.74998 4.4142 6.4142 4.75 6 4.75C5.5858 4.75 5.25002 4.4142 5.25 4C5.25 3.58579 5.58579 3.25 6 3.25Z",fill:"#BAD7F5",fillOpacity:"0.65"}),e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6 1C8.7614 1 11 3.23857 11 6C11 8.7614 8.7614 11 6 11C3.23857 11 1 8.7614 1 6C1 3.23857 3.23857 1 6 1ZM6 2C3.79086 2 2 3.79086 2 6C2 8.20915 3.79086 10 6 10C8.20915 10 10 8.20915 10 6C10 3.79086 8.20915 2 6 2Z",fill:"#BAD7F5",fillOpacity:"0.65"})]}),St=({line1:i,line2:s,className:m,style:p,barIndex:x=0,totalBars:v=7,isRightChart:w=!1})=>{const T=n.useRef(null),L=n.useRef(null),[_,l]=n.useState(0),j=M=>{const A=M.indexOf("ï¼š");return A===-1?{label:M,content:""}:{label:M.substring(0,A+1),content:M.substring(A+1).trim()}},t=j(i),u=j(s),$=M=>{let A=0;for(let F of M)/[\u4e00-\u9fa5]/.test(F)?A+=11:/[0-9]/.test(F)?A+=6:/[:ï¼š]/.test(F)||/[\s]/.test(F)?A+=4:A+=6;return A},{width:N,textX:C}=n.useMemo(()=>{const M=$(t.label),A=$(t.content),F=M+A,R=$(u.label),U=$(u.content),z=R+U;return{width:Math.max(F,z)+24,textX:12}},[t,u]),y=$(t.label),I=$(u.label);n.useEffect(()=>{let M=0;w&&x>=v-2&&(M=-N/3),l(M)},[N,x,v,w]);const b=N/2-_;return e.jsx("div",{ref:L,className:m,style:{...p,transform:_!==0?`translateX(${_}px)`:void 0},children:e.jsxs("svg",{ref:T,xmlns:"http://www.w3.org/2000/svg",width:N,height:"56",viewBox:`0 0 ${N} 56`,fill:"none",style:{filter:"drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3))",zIndex:99999},children:[e.jsx("path",{d:`M${N-8} 0C${N-3.582} 9.01959e-07 ${N} 3.58172 ${N} 8V40C${N} 44.4183 ${N-3.582} 48 ${N-8} 48H${b+2.6182}L${b} 56L${b-2.6182} 48H8C3.58172 48 1.28855e-07 44.4183 0 40V8C5.15422e-07 3.58172 3.58172 3.22128e-08 8 0H${N-8}Z`,fill:"#37404f"}),e.jsx("text",{x:C,y:"20",textAnchor:"start",fill:"rgba(186, 215, 245, 0.65)",fontSize:"10",fontFamily:"Noto Sans SC",fontStyle:"normal",fontWeight:"400",children:t.label}),t.content&&e.jsx("text",{x:C+y,y:"20",textAnchor:"start",fill:"#BAD7F5",fontSize:"10",fontFamily:"Noto Sans SC",fontStyle:"normal",fontWeight:"400",children:t.content}),e.jsx("text",{x:C,y:"36",textAnchor:"start",fill:"rgba(186, 215, 245, 0.65)",fontSize:"10",fontFamily:"Noto Sans SC",fontStyle:"normal",fontWeight:"400",children:u.label}),u.content&&e.jsx("text",{x:C+I,y:"36",textAnchor:"start",fill:"#BAD7F5",fontSize:"10",fontFamily:"Noto Sans SC",fontStyle:"normal",fontWeight:"400",children:u.content})]})})},Tt=({className:i,style:s,onClick:m})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",className:i,style:s,onClick:m,children:[e.jsx("path",{d:"M7 2.88477V2.42285C6.99994 2.31073 6.95527 2.20332 6.87598 2.12402C6.79663 2.04469 6.68891 2 6.57666 2H2.42285C2.31073 2.00006 2.20332 2.04474 2.12402 2.12402C2.04474 2.20332 2.00006 2.31073 2 2.42285V6.57666C2 6.68891 2.04469 6.79663 2.12402 6.87598C2.20332 6.95527 2.31073 6.99994 2.42285 7H2.88477C3.16084 7.00008 3.38477 7.2239 3.38477 7.5C3.38477 7.7761 3.16084 7.99992 2.88477 8H2.42285C2.04551 7.99994 1.68382 7.84981 1.41699 7.58301C1.15012 7.31611 1 6.95411 1 6.57666V2.42285C1.00006 2.04551 1.15017 1.68382 1.41699 1.41699C1.68382 1.15017 2.04551 1.00006 2.42285 1H6.57666C6.95411 1 7.31611 1.15012 7.58301 1.41699C7.84981 1.68382 7.99994 2.04551 8 2.42285V2.88477C7.99992 3.16084 7.7761 3.38477 7.5 3.38477C7.2239 3.38477 7.00008 3.16084 7 2.88477Z",fill:"#BAD7F5",fillOpacity:"0.65"}),e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11 9.5C11 10.3285 10.3285 11 9.5 11H5.5C4.67158 11 4 10.3285 4 9.5V5.5C4 4.67158 4.67158 4 5.5 4H9.5C10.3285 4 11 4.67158 11 5.5V9.5ZM10 5.5C10 5.22386 9.77615 5 9.5 5H5.5C5.22386 5 5 5.22386 5 5.5V9.5C5 9.77615 5.22386 10 5.5 10H9.5C9.77615 10 10 9.77615 10 9.5V5.5Z",fill:"#BAD7F5",fillOpacity:"0.65"})]}),wt=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",children:[e.jsx("path",{d:"M7.64609 6.14652C7.84136 5.95126 8.15864 5.95126 8.35391 6.14652L9.85391 7.64652C9.92157 7.71427 9.96984 7.80146 9.98984 7.89887C9.99664 7.93177 9.99998 7.96555 10 7.99965C10 8.03369 9.99581 8.06758 9.98906 8.10043C9.96912 8.19806 9.92172 8.28568 9.85391 8.35355L8.35391 9.85355C8.15864 10.0488 7.84136 10.0488 7.64609 9.85355C7.45108 9.65835 7.45111 9.34175 7.64609 9.14652L8.29297 8.49965H2.5C2.22386 8.49965 2 8.27579 2 7.99965C2.00019 7.72367 2.22397 7.49965 2.5 7.49965H8.29219L7.64609 6.85355C7.45108 6.65835 7.45111 6.34174 7.64609 6.14652Z",fill:"#BAD7F5",fillOpacity:"0.65"}),e.jsx("path",{d:"M3.64609 2.14652C3.84136 1.95126 4.15864 1.95126 4.35391 2.14652C4.54889 2.34174 4.54892 2.65835 4.35391 2.85355L3.70703 3.49965H9.5C9.77603 3.49965 9.99981 3.72367 10 3.99965C10 4.27579 9.77615 4.49965 9.5 4.49965H3.70703L4.35391 5.14652C4.54889 5.34175 4.54892 5.65835 4.35391 5.85355C4.15864 6.04881 3.84136 6.04881 3.64609 5.85355L2.14609 4.35355C2.11197 4.3194 2.08546 4.28055 2.06328 4.24027C2.02387 4.16878 2 4.08706 2 3.99965C2.00006 3.91215 2.02373 3.83054 2.06328 3.75902C2.08541 3.71897 2.11214 3.68052 2.14609 3.64652L3.64609 2.14652Z",fill:"#BAD7F5",fillOpacity:"0.65"})]}),Nt=""+new URL("../assets/user-C9_LOqjh.png",import.meta.url).href,Lt=()=>{const i=le(),[s,m]=n.useState(!1),[p,x]=n.useState(""),[v,w]=n.useState(!1),[T,L]=n.useState(!1),[_,l]=n.useState(()=>{const h=localStorage.getItem("steam_last_refresh_time");return h?Number(h):null}),j=n.useId(),t=K(h=>{var S;return(S=h.currentUser)==null?void 0:S.steamInfo}),u=K(h=>{var S;return(S=h.currentUser)==null?void 0:S.thirdParty}),$=K(h=>h.refreshSteamInfo),N=(u==null?void 0:u.some(h=>h.provider==="steam"&&h.is_bound))??!1,C=300*1e3;n.useEffect(()=>{const h=setTimeout(()=>{w(!0)},400);return()=>clearTimeout(h)},[]);const y=(h,S)=>{if(h===0)return 0;const Z=16-1,r=2,f=h/S,c=Math.round(f*Z);return Math.max(r,c)},{data:I}=he({queryKey:["gameTimeStatistics",t==null?void 0:t.SteamUserId],queryFn:ve,enabled:N&&!!(t!=null&&t.SteamUserId),staleTime:300*1e3,retry:1}),b=n.useMemo(()=>{var h;return!((h=I==null?void 0:I.data)!=null&&h.timeStatistics)||I.data.timeStatistics.length===0?[]:I.data.timeStatistics.map(S=>({range:S.end===-1?`${S.begin}+å°æ—¶`:`${S.begin}-${S.end}å°æ—¶`,count:S.num})).filter(S=>S.count>0)},[I]),M=n.useMemo(()=>b.length===0?1:Math.max(...b.map(h=>h.count),1),[b]),A=n.useMemo(()=>{if(t!=null&&t.Timecreated){const h=new Date().getTime()/1e3;return fe(h-(t==null?void 0:t.Timecreated))}else return 0},[t==null?void 0:t.Timecreated]);if(!N)return e.jsx(xe,{onConnectClick:()=>{ge("steam")}});const F=n.useMemo(()=>_?Date.now()-_>=C:!0,[_,C]);n.useEffect(()=>{if(!_)return;const h=Date.now(),S=C-(h-_);if(S<=0)return;const Y=setTimeout(()=>{w(Z=>!Z),w(Z=>!Z)},S);return()=>clearTimeout(Y)},[_,C]);const R=h=>{try{Ae(h),x("å¤åˆ¶æˆåŠŸï¼"),m(!0),setTimeout(()=>{m(!1)},2e3)}catch{x("å¤åˆ¶å¤±è´¥ï¼"),m(!0),setTimeout(()=>{m(!1)},2e3)}},U=async h=>{if(h&&(h.stopPropagation(),h.preventDefault()),!F||T){ie.info("æ­£åœ¨åŒæ­¥ Steam ä¿¡æ¯...");return}try{L(!0);const S=Date.now();l(S),localStorage.setItem("steam_last_refresh_time",String(S)),await $()}catch(S){console.error("åˆ·æ–° Steam ä¿¡æ¯å¤±è´¥:",S),ie.error("åˆ·æ–°å¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•")}finally{L(!1)}},z=()=>{i("/user/manage-steam")},X=(t==null?void 0:t.Status)===2;return e.jsxs("div",{className:d.container,children:[s&&e.jsx("div",{className:d.copySuccessTip,children:p}),e.jsxs("div",{className:d.mainBox,children:[e.jsx("div",{className:d.title,children:e.jsx("p",{children:"æ¸¸æˆåº“"})}),!v&&e.jsx("div",{className:d.skeletonBox,style:{height:"112px"}}),v&&e.jsxs("div",{className:d.userBoxContainer,children:[e.jsxs("div",{className:d.userInfoBox,children:[e.jsx(Ie,{level:(t==null?void 0:t.Level)||0}),e.jsx("img",{src:(t==null?void 0:t.SteamAvatar)||Nt,alt:"user avatar",className:d.userAvatar}),e.jsxs("div",{className:d.userTextInfo,children:[e.jsx("div",{className:d.userName,children:(t==null?void 0:t.SteamName)||"STEAM æ¸¸æˆåå­—"}),e.jsx("div",{className:d.userSignature,children:_e.noSignature})]})]}),X?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex items-center justify-center flex-shrink-0 text-[var(--Warning-Warning-5)]",children:e.jsx(pe,{className:"w-4 h-4"})}),e.jsx("div",{className:"flex-1 text-[var(--Warning-Warning-5)] text-xs leading-4 whitespace-nowrap",children:"æ¸¸æˆèµ„æ–™æœªå…¬å¼€ï¼ŒæŸ¥çœ‹å…¬å¼€æ•™ç¨‹"}),e.jsxs("button",{type:"button",onClick:()=>{window.open("https://help.steampowered.com/zh-cn/faqs/view/588C-C67D-0251-C276","_blank")},className:"flex items-center p-0 bg-transparent border-0 text-[#1796e2] text-xs font-medium cursor-pointer transition-all duration-200 whitespace-nowrap flex-shrink-0",children:[e.jsx("span",{className:"underline",children:"å‰å¾€"}),e.jsx(Ce,{color:"#1796e2"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:d.secondBox,children:e.jsxs("div",{className:d.infoTable,children:[e.jsxs("div",{className:d.tableColumn,children:[e.jsx("div",{className:d.tableHeader,children:"åœ°åŒº"}),e.jsx("div",{className:d.tableCell,children:(t==null?void 0:t.Country)||"æœªçŸ¥"})]}),e.jsxs("div",{className:d.tableColumn,children:[e.jsx("div",{className:d.tableHeader,children:"å¹´é™"}),e.jsx("div",{className:d.tableCell,children:A||0})]}),e.jsxs("div",{className:d.tableColumn,children:[e.jsx("div",{className:d.tableHeader,children:"æ¸¸æˆæ•°é‡"}),e.jsx("div",{className:d.tableCell,children:(t==null?void 0:t.GameCount)||0})]})]})}),e.jsxs("div",{className:d.thirdBox,children:[e.jsx("div",{className:d.leftSection,children:e.jsxs("div",{className:d.textBlock,children:[e.jsxs("div",{className:d.valueLabel,children:["è´¦å·ä»·å€¼",e.jsx("span",{"data-tooltip-id":j,"data-tooltip-content":"è´¦å·ä»·å€¼æ˜¯æ ¹æ®å½“å‰è´¦å·åº“ä¸­çš„æ‰€æœ‰æ¸¸æˆåœ¨steamè¿‡åŽ»å•†åº—çš„çŽ°æ—¶åŽŸä»·è®¡ç®—æ‰€å¾—ï¼Œä»…ä¾›å‚è€ƒ",children:e.jsx(we,{})}),e.jsx(Me,{id:j,className:"max-w-[300px] z-[9999]"})]}),e.jsxs("div",{className:d.valueAmount,children:["Â¥",(((t==null?void 0:t.AccountValues)||0)/100).toFixed(1)]})]})}),e.jsxs("div",{className:d.rightSection,children:[e.jsxs("div",{className:d.textBlock,children:[e.jsx("div",{className:d.playtimeLabel,children:"æ¸¸æˆæ—¶é•¿"}),e.jsx("div",{className:d.playtimeValue,children:be((t==null?void 0:t.GameDuration)||0)})]}),e.jsx("div",{className:d.miniChart,children:b.length>0&&b.map((h,S)=>e.jsxs("div",{className:d.chartBarContainer,children:[e.jsx("div",{className:d.chartBar,style:{height:`${y(h.count,M)}px`}}),e.jsx("div",{className:d.tooltipContainer,children:e.jsx(St,{line1:`æ—¶é•¿åŒºé—´ï¼š${h.range}`,line2:`æ¸¸æˆæ•°é‡ï¼š${h.count}`,barIndex:S,totalBars:b.length,isRightChart:!0})})]},`${h.range}-${S}`))})]})]})]})]}),v&&e.jsxs("div",{className:d.bottomBox,children:[e.jsx("div",{className:d.steamInfoContainer,children:e.jsxs("div",{className:d.steamInfo,children:[e.jsx("span",{className:d.steamLabel,children:"Steam çŽ©å®¶ä»£ç :"}),e.jsx("span",{className:d.steamValue,children:t==null?void 0:t.SteamUserId}),e.jsx(Tt,{className:d.copyIcon,onClick:()=>R(String(t==null?void 0:t.SteamUserId))})]})}),e.jsxs("div",{className:d.actionButtons,children:[e.jsxs("div",{className:d.switchAccount,onClick:z,children:[e.jsx("span",{className:d.switchText,children:"æ›´æ¢ Steam è´¦å·"}),e.jsx(wt,{})]}),e.jsxs("div",{className:`${d.refreshInfo} ${!F||T?d.disabled:""}`,onClick:U,children:[e.jsx("span",{className:d.refreshText,children:"åˆ·æ–° Steam ä¿¡æ¯"}),e.jsx(ke,{className:`${d.refreshIcon} ${T?d.rotating:""}`})]})]})]})]})]})},Bt="_gameListContainer_g6tsi_3",It="_headerRow_g6tsi_15",Mt="_headerTitle_g6tsi_25",kt="_gameCount_g6tsi_37",At="_rightControls_g6tsi_47",$t="_gamesGrid_g6tsi_54",O={gameListContainer:Bt,headerRow:It,headerTitle:Mt,gameCount:kt,rightControls:At,gamesGrid:$t},Ft=i=>{let s=[],m=i==null?void 0:i.filter,p=0;for(;typeof m=="string"&&p<3;){try{m=JSON.parse(m)}catch{break}p++}if(m&&typeof m=="object"&&Object.keys(m).forEach(x=>{const v=m[x],w=v===!0||v==="true"||v===1||v==="1";if(x.startsWith("gamePlatform-")&&w){const T=x.replace("gamePlatform-","");T==="steam"?s.push("steam"):T==="cloudGame"?s.push("cloud"):s.push(T.toLowerCase())}}),s.length===0&&i.platform){if(Array.isArray(i.platform))s=i.platform;else if(typeof i.platform=="string"){const x=i.platform.toLowerCase();x.includes("steam")&&s.push("steam"),x.includes("cloud")&&s.push("cloud"),(x.includes("windows")||x.includes("pc"))&&s.push("windows"),x.includes("xbox")&&s.push("xbox"),(x.includes("playstation")||x.includes("ps"))&&s.push("playstation"),x.includes("mac")&&s.push("apple")}}return s},Et=({onDataLoaded:i})=>{const s=le(),m="libraryState",p=()=>{try{const r=sessionStorage.getItem(m);if(r){const f=JSON.parse(r);let c={releaseTime:"none",playTime:"none"};return f.sortState&&typeof f.sortState.releaseTime=="string"&&typeof f.sortState.playTime=="string"&&["asc","desc","none"].includes(f.sortState.releaseTime)&&["asc","desc","none"].includes(f.sortState.playTime)?c=f.sortState:sessionStorage.removeItem(m),{sortState:c,filters:f.filters||{},page:f.page||1,hasMore:f.hasMore!==void 0?f.hasMore:!0,games:f.games||[],totalGames:f.totalGames||0}}}catch(r){console.error("è§£æžç¼“å­˜çŠ¶æ€å¤±è´¥:",r)}return{sortState:{releaseTime:"none",playTime:"none"},filters:{},page:1,hasMore:!0,games:[],totalGames:0}},[x,v]=n.useState(1),[w,T]=n.useState(!0),[L,_]=n.useState(!1),[l,j]=n.useState(!1),[t,u]=n.useState(!0),[$,N]=n.useState([]),[C,y]=n.useState(0),I=20,[b,M]=n.useState({releaseTime:"none",playTime:"none"}),[A,F]=n.useState({}),R=n.useRef(!0);n.useEffect(()=>{const r=setTimeout(()=>{const f=sessionStorage.getItem("fromGameDetails")==="true";let c,g=!0;f?(sessionStorage.removeItem("fromGameDetails"),c=p(),c.games&&c.games.length>0&&(g=!1)):(sessionStorage.removeItem(m),c={sortState:{releaseTime:"none",playTime:"none"},filters:{},page:1,hasMore:!0,games:[],totalGames:0}),M(c.sortState),F(c.filters),v(c.page),T(c.hasMore),N(c.games),y(c.totalGames),c.games&&c.games.length>0&&u(!1),R.current=!1,g&&z(1,!0)},100);return()=>clearTimeout(r)},[]);const U=n.useCallback(()=>{try{const r={sortState:b,filters:A,page:x,hasMore:w,games:$,totalGames:C};sessionStorage.setItem(m,JSON.stringify(r))}catch(r){console.error("ä¿å­˜çŠ¶æ€åˆ°ç¼“å­˜å¤±è´¥:",r)}},[b,A,x,w,$,C]),z=n.useCallback(async(r,f=!1)=>{var c,g;try{f||r===1?(_(!0),r===1&&$.length===0&&u(!0)):j(!0);const D={page:r,page_size:I};b.releaseTime==="asc"?D.sort_by_release_time=1:(b.releaseTime,D.sort_by_release_time=-1),b.playTime==="asc"?D.sort_by_play_time=1:D.sort_by_play_time=-1,D.filter="platform-WebLabel",Object.entries(A).forEach(([k,V])=>{V&&V.length>0&&(D[k]=V.join(","))});const Q=await Te(D),a=((c=Q.data)==null?void 0:c.list)||[],o=((g=Q.data)==null?void 0:g.total)||0;console.log("ðŸ–¥ï¸ èŽ·å–åˆ°çš„æ¸¸æˆIDåˆ—è¡¨:",a.map(k=>k==null?void 0:k.id));const H=f||r===1,W=Math.ceil(o/I)||1,G=r<W;requestAnimationFrame(()=>{N(k=>(console.log("ðŸ–¥ï¸ å½“å‰å·²æœ‰æ¸¸æˆID:",k.map(V=>V==null?void 0:V.id)),H?a:(console.log("ðŸ–¥ï¸ è¿½åŠ çš„æ–°æ¸¸æˆID:",a.map(V=>V==null?void 0:V.id)),[...k,...a]))),y(o),T(G),v(r)})}catch(D){console.error("ðŸ” èŽ·å–æ¸¸æˆæ•°æ®å¤±è´¥:",D)}finally{f||r===1?(_(!1),u(!1)):j(!1)}},[b,A,I]);n.useEffect(()=>{const r=()=>{if(document.visibilityState==="visible"){const c=sessionStorage.getItem(m);if(c)try{const g=JSON.parse(c);g.games&&g.games.length>0&&(M(g.sortState||{releaseTime:"none",playTime:"none"}),F(g.filters||{}),v(g.page||1),T(g.hasMore!==void 0?g.hasMore:!0),N(g.games||[]),y(g.totalGames||0),u(!1))}catch(g){console.error("æ¢å¤ç¼“å­˜çŠ¶æ€å¤±è´¥:",g)}}},f=sessionStorage.getItem(m);if(f)try{const c=JSON.parse(f);console.log("ðŸ” åˆå§‹åŒ–æ—¶æ£€æŸ¥ç¼“å­˜æ•°æ®:",c),c.games&&c.games.length>0&&$.length===0&&(M(c.sortState||{releaseTime:"none",playTime:"none"}),F(c.filters||{}),v(c.page||1),T(c.hasMore!==void 0?c.hasMore:!0),N(c.games||[]),y(c.totalGames||0),u(!1))}catch(c){console.error("åˆå§‹åŒ–æ¢å¤ç¼“å­˜çŠ¶æ€å¤±è´¥:",c)}return document.addEventListener("visibilitychange",r),()=>document.removeEventListener("visibilitychange",r)},[]),n.useEffect(()=>{R.current||z(1,!0)},[b,A]),n.useEffect(()=>{$.length>0&&U()},[$.length,U]),n.useEffect(()=>{i&&!L&&$.length>0&&i(!0)},[i,L,$.length]);const X=n.useCallback(()=>{if(L||l||!w)return;const r=x+1;z(r,!1)},[L,l,w,x,z]);n.useEffect(()=>{let r;const f=()=>{clearTimeout(r),r=setTimeout(()=>{const g=document.getElementById("main");if(!g)return;const D=g.scrollTop,Q=g.clientHeight,a=g.scrollHeight;D+Q>=a-200&&X()},100)},c=document.getElementById("main");if(c)return c.addEventListener("scroll",f,{passive:!0}),()=>{c.removeEventListener("scroll",f),clearTimeout(r)}},[X]);const h=n.useCallback(r=>{console.log("ðŸ” æŽ’åºæŒ‰é’®ç‚¹å‡»:",r),M(f=>{const c={...f};return r==="time"?f.releaseTime==="asc"?c.releaseTime="none":c.releaseTime="asc":r==="playTime"&&(f.playTime==="asc"?c.playTime="none":c.playTime="asc"),c})},[]),S=n.useCallback(r=>{F(r)},[]),Y=n.useCallback(r=>{sessionStorage.setItem("fromGameDetails","true"),s(`/game/${r}`)},[s]),Z=n.useMemo(()=>[{label:"å‘å¸ƒæ—¶é—´",active:b.releaseTime!=="none",showIcon:!0,onClick:()=>h("time"),sortType:"time"},{label:"æ¸¸çŽ©æ—¶é—´",active:b.playTime==="asc",showIcon:!0,onClick:()=>h("playTime"),sortType:"playTime"}],[b.releaseTime,b.playTime,h]);return n.useEffect(()=>{const r=()=>{const c=sessionStorage.getItem(m);if(c)try{const g=JSON.parse(c);console.log("ðŸ” è·¯ç”±å˜åŒ–æ—¶æ¢å¤ç¼“å­˜:",g),g.games&&g.games.length>0&&(M(g.sortState||{releaseTime:"none",playTime:"none"}),F(g.filters||{}),v(g.page||1),T(g.hasMore!==void 0?g.hasMore:!0),N(g.games||[]),y(g.totalGames||0),u(!1))}catch(g){console.error("è·¯ç”±å˜åŒ–æ—¶æ¢å¤ç¼“å­˜å¤±è´¥:",g)}};window.addEventListener("popstate",r),window.addEventListener("hashchange",r);const f=()=>{r()};return window.addEventListener("focus",f),()=>{window.removeEventListener("popstate",r),window.removeEventListener("hashchange",r),window.removeEventListener("focus",f)}},[]),n.useEffect(()=>{const r=()=>{const f=performance.getEntriesByType("navigation")[0];(f==null?void 0:f.type)==="reload"&&sessionStorage.removeItem(m)};return window.addEventListener("beforeunload",r),()=>window.removeEventListener("beforeunload",r)},[]),t?e.jsxs("div",{className:O.gameListContainer,children:[e.jsxs("div",{className:O.headerRow,children:[e.jsx("div",{className:O.headerTitle,children:"æˆ‘çš„æ¸¸æˆ"}),e.jsx("div",{className:O.rightControls,children:e.jsx(ce,{leftButtons:Z,onFilterChange:S,currentFilters:A,isLoading:L,fullSortState:b})})]}),e.jsx("div",{className:O.gamesGrid,children:Array.from({length:20}).map((r,f)=>e.jsx("div",{className:"game-card-item",children:e.jsx(de,{title:"",cover:"",tags:[],platforms:[],value:0,onClick:()=>{},isLoading:!0,maxTags:3})},`skeleton-${f}`))})]}):!L&&$.length===0?e.jsxs("div",{className:O.gameListContainer,children:[e.jsxs("div",{className:O.headerRow,children:[e.jsxs("div",{className:O.headerTitle,children:["æˆ‘çš„æ¸¸æˆ",e.jsxs("span",{className:O.gameCount,children:["(",C,")"]})]}),e.jsx("div",{className:O.rightControls,children:e.jsx(ce,{leftButtons:Z,onFilterChange:S,currentFilters:A,isLoading:L,fullSortState:b})})]}),e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",width:"100%"},children:e.jsx(ye,{})})]}):e.jsxs("div",{className:O.gameListContainer,children:[e.jsxs("div",{className:O.headerRow,children:[e.jsxs("div",{className:O.headerTitle,children:["æˆ‘çš„æ¸¸æˆ",!t&&e.jsxs("span",{className:O.gameCount,children:["(",C,")"]})]}),e.jsx("div",{className:O.rightControls,children:e.jsx(ce,{leftButtons:Z,onFilterChange:S,currentFilters:A,isLoading:L,fullSortState:b})})]}),e.jsx("div",{className:O.gamesGrid,children:$.map(r=>e.jsx("div",{className:"game-card-item",children:e.jsx(de,{title:r.name||"æœªçŸ¥æ¸¸æˆ",cover:r.cover_image||r.cover||"",tags:r.top_category_tags?Object.values(r.top_category_tags).filter(f=>typeof f=="string"):[],platforms:Ft(r),value:r.review_percentage||0,onClick:()=>Y(r.id),isLoading:L,maxTags:3})},r.id))}),$.length>0&&e.jsx(Se,{loading:l,hasMore:w})]})},Ht=n.memo(Et),Gt=({className:i,style:s})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",className:i,style:s,children:e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M13.9999 2C14.2582 2 14.4935 2.14913 14.6034 2.38281C14.7134 2.61649 14.6782 2.89283 14.5136 3.0918L9.99993 8.54622V14C9.99993 14.231 9.88057 14.4455 9.68418 14.5671C9.48764 14.6885 9.24175 14.6997 9.03509 14.5964L6.36842 13.263C6.14264 13.1501 5.99993 12.9191 5.99993 12.6667V8.54622L1.48626 3.0918C1.32164 2.89283 1.28712 2.61648 1.39707 2.38281C1.50701 2.14924 1.74178 2.00007 1.99993 2H13.9999ZM7.18027 7.88151C7.27917 8.00104 7.33326 8.1515 7.33326 8.30664V12.2546L8.6666 12.9212V8.30664C8.6666 8.1515 8.72073 8.00104 8.81959 7.88151L12.5826 3.33333H3.41725L7.18027 7.88151Z",fill:"#BAD7F5"})}),Rt="_container_tpn9b_2",Vt="_icon_tpn9b_14",Dt="_badge_tpn9b_22",Ot="_badgeText_tpn9b_39",re={container:Rt,icon:Vt,badge:Dt,badgeText:Ot},Pt=({filterCount:i,onClick:s,className:m,style:p})=>e.jsxs("div",{onClick:s,className:`${re.container} ${m||""}`,style:p,"data-filter-button":!0,children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 14 14",fill:"none",className:re.icon,children:e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12.2496 1.75C12.4756 1.75 12.6815 1.88049 12.7777 2.08496C12.8739 2.28943 12.8431 2.53123 12.6991 2.70532L8.74963 7.47795V12.25C8.74963 12.4521 8.6452 12.6398 8.47335 12.7462C8.30138 12.8525 8.08623 12.8622 7.9054 12.7718L5.57206 11.6051C5.37451 11.5063 5.24963 11.3043 5.24963 11.0833V7.47795L1.30017 2.70532C1.15613 2.53122 1.12593 2.28942 1.22213 2.08496C1.31833 1.88058 1.52375 1.75006 1.74963 1.75H12.2496ZM6.28243 6.89632C6.36897 7.00091 6.41629 7.13256 6.4163 7.26831V10.7227L7.58297 11.3061V7.26831C7.58297 7.13256 7.63033 7.00091 7.71684 6.89632L11.0095 2.91667H2.98979L6.28243 6.89632Z",fill:"currentColor"})}),i>0&&e.jsx("div",{className:re.badge,children:e.jsx("span",{className:re.badgeText,children:i})})]}),Wt="_filterPanel_10brr_1",zt="_section_10brr_41",Zt="_sectionHeader_10brr_45",Ut="_sectionTitle_10brr_52",qt="_resetLink_10brr_59",Jt="_tagGroup_10brr_77",Xt="_tag_10brr_77",Yt="_active_10brr_122",J={filterPanel:Wt,section:zt,sectionHeader:Zt,sectionTitle:Ut,resetLink:qt,tagGroup:Jt,tag:Xt,active:Yt},Kt=i=>i.replace(/\(/g,"â€€("),Qt=({isVisible:i,onFilterChange:s,filters:m})=>{const p=m||{},[x,v]=n.useState([]),[w,T]=n.useState(!0);n.useEffect(()=>{i&&(async()=>{try{T(!0);const t=(await je()).data;t&&t.code===200&&t.data?v(t.data):Array.isArray(t)&&v(t)}catch(j){console.error("èŽ·å–ç­›é€‰æ ‡ç­¾å¤±è´¥:",j)}finally{T(!1)}})()},[i]);const L=(l,j)=>{const t=p[l]||[],$=t.includes(j)?t.filter(C=>C!==j):[...t,j],N={...p,[l]:$};s==null||s(N)},_=()=>{const l={};s==null||s(l)};return i?e.jsx("div",{className:J.filterPanel,"data-filter-panel":!0,children:w?e.jsx("div",{className:J.section,children:e.jsx("div",{children:"åŠ è½½ä¸­..."})}):x.map((l,j)=>e.jsxs("div",{className:J.section,children:[e.jsxs("div",{className:J.sectionHeader,children:[e.jsx("h3",{className:J.sectionTitle,children:l.name}),j===0&&e.jsx("button",{className:J.resetLink,onClick:()=>_(),children:"é‡ç½®"})]}),e.jsx("div",{className:J.tagGroup,children:l.tags.map(t=>{const u=(p[l.key]||[]).includes(t.value);return e.jsx("button",{className:`${J.tag} ${u?J.active:""}`,onClick:()=>L(l.key,t.value),children:Kt(t.name)},t.value)})})]},l.key))}):null},es="_overlay_14tc6_2",ts="_closeArea_14tc6_21",ss="_open_14tc6_36",as="_filterModal_14tc6_42",ns="_modalContent_14tc6_70",rs="_sectionTitle_14tc6_82",os="_filterGrid_14tc6_92",is="_filterButton_14tc6_99",ls="_selected_14tc6_126",cs="_bottomButtons_14tc6_145",ds="_resetButton_14tc6_152",ms="_applyButton_14tc6_177",P={overlay:es,closeArea:ts,open:ss,filterModal:as,modalContent:ns,sectionTitle:rs,filterGrid:os,filterButton:is,selected:ls,bottomButtons:cs,resetButton:ds,applyButton:ms},us=({isOpen:i,onClose:s,onApply:m,filters:p})=>{const[x,v]=n.useState(()=>p||{}),[w,T]=n.useState([]),[L,_]=n.useState(!0);$e.useEffect(()=>{p&&v(p)},[p]),n.useEffect(()=>{i&&(async()=>{try{_(!0);const I=(await je()).data;I&&I.code===200&&I.data?T(I.data):Array.isArray(I)&&T(I)}catch(y){console.error("èŽ·å–ç­›é€‰æ ‡ç­¾å¤±è´¥:",y)}finally{_(!1)}})()},[i]);const l=L?[{key:"loading",title:"åŠ è½½ä¸­...",options:[]}]:w.map(C=>({key:C.key,title:C.name,options:C.tags})),j=(C,y)=>{if(L||y==="åŠ è½½ä¸­...")return;const I={...x},b=I[C]||[];b.includes(y)?I[C]=b.filter(M=>M!==y):I[C]=[...b,y],v(I)},t=()=>{v({})},u=()=>{m==null||m(x),s()},$=()=>{p&&v(p),s()},N=Object.values(x).flat().length;return i?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`${P.overlay} ${P.open}`}),e.jsx("div",{className:`${P.closeArea} ${P.open}`,onClick:$}),e.jsxs("div",{className:`${P.filterModal} ${P.open}`,children:[e.jsx("div",{className:P.modalContent,children:l.map(C=>e.jsxs("div",{className:P.filterSection,children:[e.jsx("h3",{className:P.sectionTitle,children:C.title}),e.jsx("div",{className:P.filterGrid,children:C.options.map(y=>e.jsx("button",{type:"button",className:`${P.filterButton} ${(x[C.key]||[]).includes(y.value||y)?P.selected:""}`,onClick:()=>j(C.key,y.value||y),children:y.name||y},y.value||y))})]},C.key))}),e.jsxs("div",{className:P.bottomButtons,children:[e.jsx("button",{className:P.resetButton,onClick:t,children:"é‡ç½®"}),e.jsxs("button",{className:P.applyButton,onClick:u,children:["ç­›é€‰ ",N>0?`(${N})`:""]})]})]})]}):null},hs="_buttonGroup_kmdtp_1",fs="_titleSection_kmdtp_8",xs="_sectionTitle_kmdtp_13",gs="_gameCount_kmdtp_26",_s="_rightButtons_kmdtp_36",ps="_leftButtons_kmdtp_42",Cs="_active_kmdtp_116",bs="_sortButtonWithIcon_kmdtp_164",vs="_sortIcon_kmdtp_219",js="_pcSortIcon_kmdtp_292",ys="_mobileSortIcon_kmdtp_296",Ss="_filterContainer_kmdtp_318",Ts="_pcFilterButton_kmdtp_323",ws="_mobileFilterIcon_kmdtp_328",Ns="_filterButton_kmdtp_332",Ls="_filterIcon_kmdtp_399",Bs="_filterCount_kmdtp_412",Is="_pcText_kmdtp_427",Ms="_mobileText_kmdtp_431",B={buttonGroup:hs,titleSection:fs,sectionTitle:xs,gameCount:gs,rightButtons:_s,leftButtons:ps,active:Cs,sortButtonWithIcon:bs,sortIcon:vs,pcSortIcon:js,mobileSortIcon:ys,filterContainer:Ss,pcFilterButton:Ts,mobileFilterIcon:ws,filterButton:Ns,filterIcon:Ls,filterCount:Bs,pcText:Is,mobileText:Ms},ks=({onSortChange:i,onFilterClick:s,onFilterChange:m,sortState:p={releaseTime:"none",playTime:"none"},isFilterActive:x=!1,showFilterPanel:v=!1,filters:w,isLoading:T=!1,totalGames:L=0})=>{const[_,l]=n.useState({}),[j,t]=n.useState(!1),u=w||_,N=u?Object.values(u).reduce((F,R)=>F+(Array.isArray(R)?R.length:0),0):0,C=F=>{w?m==null||m(F):l(F)},y=()=>{t(!0)},I=()=>{t(!1)},b=F=>{C(F),t(!1)},M=F=>({time:"å‘å¸ƒæ—¶é—´",playTime:"æ¸¸çŽ©æ—¶é—´"})[F],A=()=>u&&Object.values(u).some(R=>Array.isArray(R)&&R.length>0)?"ç­›é€‰ç»“æžœ":"æˆ‘çš„æ¸¸æˆ";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:B.buttonGroup,children:[e.jsx("div",{className:B.titleSection,children:e.jsx(ne,{isLoading:T,delay:0,borderRadius:"8px",style:{width:"fit-content",height:"28px"},children:e.jsxs("h3",{className:B.sectionTitle,children:[A(),e.jsxs("span",{className:B.gameCount,children:["(",L,")"]})]})})}),e.jsxs("div",{className:B.rightButtons,children:[e.jsxs("div",{className:B.leftButtons,children:[e.jsx(ne,{isLoading:T,delay:0,borderRadius:"28px",children:e.jsxs("button",{className:`${B.sortButtonWithIcon} ${p.releaseTime!=="none"&&!v?B.active:""}`,onClick:()=>{v&&s&&s(),i==null||i("time")},children:[e.jsx("span",{className:B.pcText,children:M("time")}),e.jsx("span",{className:B.mobileText,children:M("time")}),e.jsx(me,{className:`${B.sortIcon} ${B.pcSortIcon}`,style:{transform:p.releaseTime==="asc"?"rotate(180deg) scaleX(-1)":"none",transition:"transform 0.2s ease"}}),e.jsx(ue,{className:`${B.sortIcon} ${B.mobileSortIcon}`,sortDirection:p.releaseTime})]})}),e.jsx(ne,{isLoading:T,delay:0,borderRadius:"28px",children:e.jsxs("button",{className:`${B.sortButtonWithIcon} ${p.playTime==="asc"&&!v?B.active:""}`,onClick:()=>{v&&s&&s(),i==null||i("playTime")},children:[e.jsx("span",{className:B.pcText,children:M("playTime")}),e.jsx("span",{className:B.mobileText,children:M("playTime")}),e.jsx(me,{className:`${B.sortIcon} ${B.pcSortIcon}`,style:{transform:p.playTime==="asc"?"rotate(180deg) scaleX(-1)":"none",transition:"transform 0.2s ease"}}),e.jsx(ue,{className:`${B.sortIcon} ${B.mobileSortIcon}`,sortDirection:p.playTime})]})})]}),e.jsxs("div",{className:B.filterContainer,children:[e.jsx(ne,{isLoading:T,delay:0,borderRadius:"28px",children:e.jsxs("button",{className:`${B.filterButton} ${B.pcFilterButton} ${x||v?B.active:""}`,onClick:s,"data-filter-button":!0,children:[e.jsx(Gt,{className:B.filterIcon}),e.jsx("span",{className:B.pcText,children:"ç­›é€‰å™¨"}),N>0&&e.jsxs("span",{className:B.filterCount,children:["(",N,")"]})]})}),e.jsx(Pt,{filterCount:N,onClick:y,className:B.mobileFilterIcon}),e.jsx(Qt,{isVisible:v,onFilterChange:C,filters:u})]})]})]}),e.jsx(us,{isOpen:j,onClose:I,onApply:b,filters:u})]})},As=({className:i,style:s,level:m=0})=>e.jsxs("div",{style:{position:"relative",display:"inline-block"},children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"30",height:"30",viewBox:"0 0 30 30",fill:"none",className:i,style:s,children:e.jsx("path",{d:"M29.5 7.80859V22.1904L15 29.4404L0.5 22.1904V7.80859L15 0.558594L29.5 7.80859Z",stroke:"#FFBCBC"})}),e.jsx("div",{style:{position:"absolute",top:"14px",left:"14.5px",transform:"translate(-50%, -50%)",color:"#FFF",fontFamily:'"Noto Sans SC"',fontSize:"14px",fontStyle:"normal",fontWeight:"700",lineHeight:"1",whiteSpace:"nowrap"},children:m})]}),$s=""+new URL("../assets/user-C9_LOqjh.png",import.meta.url).href,Fs="_container_139ow_2",Es="_userBasicInfo_139ow_12",Hs="_userProfileContainer_139ow_22",Gs="_avatarContainer_139ow_31",Rs="_avatar_139ow_31",Vs="_userInfo_139ow_82",Ds="_userNameContainer_139ow_91",Os="_userName_139ow_91",Ps="_refreshBtn_139ow_109",Ws="_rotating_139ow_138",zs="_userSignature_139ow_151",Zs="_personalInfoArea_139ow_160",Us="_regionCard_139ow_170",qs="_regionTitle_139ow_185",Js="_regionSubtitle_139ow_195",Xs="_statsCard_139ow_205",Ys="_statItem_139ow_221",Ks="_statValue_139ow_229",Qs="_statLabel_139ow_239",ea="_accountValueLabel_139ow_249",ta="_accountValueText_139ow_257",E={container:Fs,userBasicInfo:Es,userProfileContainer:Hs,avatarContainer:Gs,avatar:Rs,userInfo:Vs,userNameContainer:Ds,userName:Os,refreshBtn:Ps,rotating:Ws,userSignature:zs,personalInfoArea:Zs,regionCard:Us,regionTitle:qs,regionSubtitle:Js,statsCard:Xs,statItem:Ys,statValue:Ks,statLabel:Qs,accountValueLabel:ea,accountValueText:ta},sa=i=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 12 12","aria-label":"Alipay Icon",role:"img",...i,children:[e.jsx("title",{children:"Change Icon"}),e.jsx("desc",{children:"change å›¾æ ‡"}),e.jsx("path",{d:"M7.64609 6.14645C7.84136 5.95118 8.15864 5.95118 8.35391 6.14645L9.85391 7.64645C9.92157 7.7142 9.96984 7.80139 9.98984 7.89879C9.99664 7.93169 9.99998 7.96547 10 7.99957C10 8.03361 9.99581 8.0675 9.98906 8.10035C9.96912 8.19798 9.92172 8.2856 9.85391 8.35348L8.35391 9.85348C8.15864 10.0487 7.84136 10.0487 7.64609 9.85348C7.45108 9.65827 7.45111 9.34167 7.64609 9.14645L8.29297 8.49957H2.5C2.22386 8.49957 2 8.27571 2 7.99957C2.00019 7.72359 2.22397 7.49957 2.5 7.49957H8.29219L7.64609 6.85348C7.45108 6.65827 7.45111 6.34167 7.64609 6.14645Z",fill:"currentColor"}),e.jsx("path",{d:"M3.64609 2.14645C3.84136 1.95118 4.15864 1.95118 4.35391 2.14645C4.54889 2.34167 4.54892 2.65827 4.35391 2.85348L3.70703 3.49957H9.5C9.77603 3.49957 9.99981 3.72359 10 3.99957C10 4.27571 9.77615 4.49957 9.5 4.49957H3.70703L4.35391 5.14645C4.54889 5.34167 4.54892 5.65827 4.35391 5.85348C4.15864 6.04874 3.84136 6.04874 3.64609 5.85348L2.14609 4.35348C2.11197 4.31932 2.08546 4.28047 2.06328 4.2402C2.02387 4.16871 2 4.08698 2 3.99957C2.00006 3.91207 2.02373 3.83047 2.06328 3.75895C2.08541 3.71889 2.11214 3.68044 2.14609 3.64645L3.64609 2.14645Z",fill:"currentColor"})]}),aa="data:image/svg+xml,%3csvg%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M2.33333%2014.0002V11.3335C2.33333%2010.9653%202.63181%2010.6668%202.99999%2010.6668H5.66666C6.03485%2010.6668%206.33333%2010.9653%206.33333%2011.3335C6.33324%2011.7016%206.03479%2012.0002%205.66666%2012.0002H4.47395C5.41445%2012.83%206.64803%2013.3335%207.99999%2013.3335C10.9455%2013.3335%2013.3332%2010.9456%2013.3333%208.00016C13.3333%207.63196%2013.6318%207.3335%2014%207.3335C14.3682%207.3335%2014.6667%207.63196%2014.6667%208.00016C14.6666%2011.682%2011.6818%2014.6668%207.99999%2014.6668C6.34481%2014.6668%204.83179%2014.0613%203.66666%2013.0633V14.0002C3.66657%2014.3683%203.36813%2014.6668%202.99999%2014.6668C2.63187%2014.6668%202.33342%2014.3683%202.33333%2014.0002Z'%20fill='%23BAD7F5'%20fill-opacity='0.65'/%3e%3cpath%20d='M13%201.3335C13.3682%201.3335%2013.6667%201.63197%2013.6667%202.00016V4.66683C13.6666%205.03494%2013.3681%205.3335%2013%205.3335H10.3333C9.9652%205.33349%209.66675%205.03493%209.66666%204.66683C9.66666%204.29865%209.96515%204.00017%2010.3333%204.00016H11.5273C10.5867%203.16987%209.35239%202.66683%207.99999%202.66683C5.05449%202.66684%202.66666%205.05465%202.66666%208.00016C2.66657%208.36829%202.36814%208.66683%201.99999%208.66683C1.63187%208.66681%201.33342%208.36827%201.33333%208.00016C1.33333%204.31827%204.31816%201.33351%207.99999%201.3335C9.6551%201.3335%2011.1682%201.93851%2012.3333%202.93636V2.00016C12.3333%201.63198%2012.6318%201.33351%2013%201.3335Z'%20fill='%23BAD7F5'%20fill-opacity='0.65'/%3e%3c/svg%3e",na=()=>{const i=le(),s=K(l=>{var j;return(j=l.currentUser)==null?void 0:j.steamInfo}),m=K(l=>{var j;return(j=l.currentUser)==null?void 0:j.thirdParty}),p=K(l=>l.refreshSteamInfo),[x,v]=n.useState(!1),w=(m==null?void 0:m.some(l=>l.provider==="steam"&&l.is_bound))??!1,T=n.useMemo(()=>{if(s!=null&&s.Timecreated){const l=Date.now()/1e3;return fe(l-s.Timecreated).replace(" å¹´","")}else return"0.0"},[s==null?void 0:s.Timecreated]),L=async()=>{if(!x)try{v(!0),await p(),ie.success("Steam ä¿¡æ¯å·²åˆ·æ–°")}catch(l){console.error("åˆ·æ–° Steam ä¿¡æ¯å¤±è´¥:",l),ie.error("åˆ·æ–°å¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•")}finally{v(!1)}};if(!w)return e.jsx("div",{className:E.container,children:e.jsx(xe,{onConnectClick:()=>{ge("steam")}})});const _=(s==null?void 0:s.Status)===2;return e.jsxs("div",{className:E.container,children:[e.jsxs("div",{className:E.userBasicInfo,children:[e.jsxs("div",{className:E.userProfileContainer,children:[e.jsxs("div",{className:E.avatarContainer,children:[e.jsx("img",{src:(s==null?void 0:s.SteamAvatar)||$s,alt:"ç”¨æˆ·å¤´åƒ",className:E.avatar}),e.jsxs("button",{type:"button",onClick:()=>i("/mobile-user/manage-steam"),className:"absolute left-0 bottom-0 w-full h-3.5 bg-floating-60 text-b100 text-[10px] leading-3.5 flex items-center justify-center","aria-label":"åˆ‡æ¢Steamè´¦å·",children:[e.jsx("span",{children:"åˆ‡å·"}),e.jsx(sa,{className:"relative top-[1px]"})]})]}),e.jsxs("div",{className:E.userInfo,children:[e.jsxs("div",{className:E.userNameContainer,children:[e.jsx("div",{className:E.userName,children:(s==null?void 0:s.SteamName)||"STEAM æ¸¸æˆåå­—"}),e.jsx("button",{type:"button",onClick:L,disabled:x,className:E.refreshBtn,"aria-label":"åˆ·æ–°Steamä¿¡æ¯",children:e.jsx("img",{src:aa,alt:"åˆ·æ–°",className:x?E.rotating:""})})]}),e.jsx("div",{className:E.userSignature,children:_e.noSignature})]})]}),e.jsx("div",{children:e.jsx(As,{level:(s==null?void 0:s.Level)||0})})]}),_?e.jsxs("div",{className:"flex items-center gap-2 w-full p-2 bg-[rgba(249,216,2,0.1)] rounded-lg",children:[e.jsx("div",{className:"flex items-center justify-center flex-shrink-0 text-[#F9D802]",children:e.jsx(pe,{className:"w-4 h-4"})}),e.jsx("div",{className:"flex-1 text-[#F9D802] text-xs font-normal leading-[1.33] min-w-0",children:"æ¸¸æˆèµ„æ–™æœªå…¬å¼€ï¼ŒæŸ¥çœ‹å…¬å¼€æ•™ç¨‹"}),e.jsxs("button",{type:"button",onClick:()=>{window.open("https://help.steampowered.com/zh-cn/faqs/view/588C-C67D-0251-C276","_blank")},className:"flex items-center gap-0 p-0 bg-transparent border-0 text-[#1796E2] text-xs font-normal cursor-pointer transition-opacity duration-200 whitespace-nowrap flex-shrink-0 active:opacity-70",children:[e.jsx("span",{className:"underline",children:"å‰å¾€"}),e.jsx(Ce,{width:16,height:16,color:"#1796E2",opacity:1})]})]}):e.jsxs("div",{className:E.personalInfoArea,children:[e.jsxs("div",{className:E.regionCard,children:[e.jsx("div",{className:E.regionTitle,children:(s==null?void 0:s.Country)||"ä¸­å›½"}),e.jsxs("div",{className:E.regionSubtitle,children:[T," å¹´"]})]}),e.jsxs("div",{className:E.statsCard,children:[e.jsxs("div",{className:E.statItem,children:[e.jsx("div",{className:E.statValue,children:(s==null?void 0:s.GameCount)||0}),e.jsx("div",{className:E.statLabel,children:"æ¸¸æˆæ•°é‡"})]}),e.jsxs("div",{className:E.statItem,children:[e.jsx("div",{className:E.statValue,children:be((s==null?void 0:s.GameDuration)||0)}),e.jsx("div",{className:E.statLabel,children:"æ¸¸æˆæ—¶é•¿"})]}),e.jsxs("div",{className:E.statItem,children:[e.jsxs("div",{className:E.statValue,children:["Â¥",(((s==null?void 0:s.AccountValues)||0)/100).toFixed(1)]}),e.jsxs("div",{className:E.accountValueLabel,children:[e.jsx("div",{className:E.accountValueText,children:"è´¦å·ä»·å€¼"}),e.jsx(we,{})]})]})]})]})]})},ra="_container_aka7z_2",oa="_title_aka7z_7",ia="_chartContainer_aka7z_15",la="_yAxisLabels_aka7z_23",ca="_barChartArea_aka7z_39",da="_barItem_aka7z_54",ma="_barValue_aka7z_65",ua="_bar_aka7z_39",ha="_xAxisLabels_aka7z_82",fa="_xAxisLabel_aka7z_82",q={container:ra,title:oa,chartContainer:ia,yAxisLabels:la,barChartArea:ca,barItem:da,barValue:ma,bar:ua,xAxisLabels:ha,xAxisLabel:fa},xa=({type:i,data:s})=>{const p=s||[{label:"ä»ŽæœªçŽ©è¿‡",count:150},{label:"0-1h",count:52},{label:"1-3h",count:12},{label:"3-10h",count:20},{label:"10-30h",count:36},{label:"30-100h",count:19},{label:"100h",count:14}],x=Math.max(...p.map(_=>_.count),1),w=(_=>{if(_===0)return 10;const l=_*1.2,j=Math.pow(10,Math.floor(Math.log10(l))),t=l/j;let u;return t<=1?u=1:t<=2?u=2:t<=5?u=5:u=10,u*j})(x),T=_=>{if(_===0)return 0;const l=100,j=6,t=_/w,u=Math.round(t*l);return Math.max(j,u)},L=()=>[w,Math.round(w*.75),Math.round(w*.5),Math.round(w*.25),0];return e.jsxs("div",{className:q.container,children:[e.jsx("div",{className:q.title,children:i==="duration"?"æ¸¸æˆæ—¶é•¿åˆ†å¸ƒ":"æ¸¸æˆä»·å€¼åˆ†å¸ƒ"}),e.jsxs("div",{className:q.chartContainer,children:[e.jsx("div",{className:q.yAxisLabels,children:L().map((_,l)=>e.jsx("div",{children:_},l))}),e.jsx("div",{className:q.barChartArea,children:p.map((_,l)=>e.jsxs("div",{className:q.barItem,children:[e.jsx("div",{className:q.barValue,children:_.count}),e.jsx("div",{className:q.bar,style:{height:`${T(_.count)}px`}})]},l))}),e.jsx("div",{className:q.xAxisLabels,children:p.map((_,l)=>e.jsx("div",{className:q.xAxisLabel,children:_.label},l))})]})]})},ga="_mobileLibraryContainer_o4qzo_2",_a="_emptyStateContainer_o4qzo_12",pa="_loadMoreContainer_o4qzo_21",Ca="_mobileLibraryGrid_o4qzo_30",oe={mobileLibraryContainer:ga,emptyStateContainer:_a,loadMoreContainer:pa,mobileLibraryGrid:Ca},ba=()=>{const i=le(),s=K(a=>{var o;return(o=a.currentUser)==null?void 0:o.steamInfo}),m=K(a=>{var o;return(o=a.currentUser)==null?void 0:o.thirdParty}),p=(m==null?void 0:m.some(a=>a.provider==="steam"&&a.is_bound))??!1,x="mobileLibrary_state",v=()=>{try{const a=sessionStorage.getItem(x);if(a){const o=JSON.parse(a);return{sortState:o.sortState||{releaseTime:"none",playTime:"desc"},filters:o.filters||{},games:o.games||[],currentPage:o.currentPage||1,hasMore:o.hasMore!==void 0?o.hasMore:!0}}}catch(a){console.error("æ¢å¤æ‰‹æœºç«¯æ¸¸æˆåº“ç¼“å­˜çŠ¶æ€å¤±è´¥:",a)}return{sortState:{releaseTime:"none",playTime:"desc"},filters:{},games:[],currentPage:1,hasMore:!0}},[w,T]=n.useState([]),[L,_]=n.useState(!1),[l,j]=n.useState(!0),[t,u]=n.useState(1),[$,N]=n.useState(0),C=20,[y,I]=n.useState({releaseTime:"none",playTime:"desc"}),[b,M]=n.useState({}),[A,F]=n.useState(!1),R=n.useCallback(async(a,o=!1)=>{var H,W;try{_(!0);const G={page:a,page_size:C};y.releaseTime==="asc"?G.sort_by_release_time=1:(y.releaseTime,G.sort_by_release_time=-1),y.playTime==="asc"?G.sort_by_play_time=1:G.sort_by_play_time=-1,G.filter="platform-WebLabel",Object.entries(b).forEach(([ae,ee])=>{if(ee&&ee.length>0)if(ae==="gameType"||ee.some(te=>te.startsWith("category-"))){const te=ee.filter(Be=>Be.startsWith("category-"));te.length>0&&(G.filter?G.filter=G.filter+","+te.join(","):G.filter=te.join(","))}else G[ae]=ee.join(",")});const k=await Te(G),V=((H=k.data)==null?void 0:H.list)||[],se=((W=k.data)==null?void 0:W.total)||0;o?T(ae=>[...ae,...V]):(T(V),u(a));const Ne=se>0?Math.ceil(se/C):0,Le=se>0&&a<Ne;o?o&&V.length>0&&u(a):u(a),j(Le),N(se)}catch(G){console.error("èŽ·å–æ¸¸æˆæ•°æ®å¤±è´¥:",G)}finally{_(!1)}},[C,y,b]);n.useEffect(()=>{const a=sessionStorage.getItem("fromGameDetails")==="true";let o,H=!0;a?(sessionStorage.removeItem("fromGameDetails"),o=v(),o.games&&o.games.length>0&&(H=!1)):(sessionStorage.removeItem(x),o={sortState:{releaseTime:"none",playTime:"none"},filters:{},games:[],currentPage:1,hasMore:!0}),I(o.sortState),M(o.filters),u(o.currentPage),j(o.hasMore),T(o.games),H&&R(1,!1)},[]),n.useEffect(()=>{p&&(t>0||w.length>=0)&&R(1,!1)},[y,b,p]);const U=n.useRef(!1),z=n.useRef(L),X=n.useRef(l),h=n.useRef(t);n.useEffect(()=>{z.current=L,X.current=l,h.current=t},[L,l,t]);const S=n.useCallback(()=>{if(U.current||z.current||!X.current)return;const a=window.pageYOffset||document.documentElement.scrollTop,o=window.innerHeight;document.documentElement.scrollHeight-(a+o)<=300&&(U.current=!0,R(h.current+1,!0).finally(()=>{U.current=!1}))},[R]),Y=n.useRef(null);n.useEffect(()=>{const a=Y.current;if(!a)return;const o=new IntersectionObserver(H=>{const[W]=H;W.isIntersecting&&S()},{root:null,rootMargin:"200px",threshold:0});return o.observe(a),()=>{o.disconnect()}},[S]),n.useEffect(()=>{let a;const o=()=>{clearTimeout(a),a=setTimeout(()=>{S()},150)};return window.addEventListener("scroll",o,{passive:!0}),()=>{window.removeEventListener("scroll",o),clearTimeout(a)}},[S]),n.useEffect(()=>{try{const a={sortState:y,filters:b,games:w,currentPage:t,hasMore:l};sessionStorage.setItem(x,JSON.stringify(a))}catch(a){console.error("ä¿å­˜æ‰‹æœºç«¯æ¸¸æˆåº“ç¼“å­˜å¤±è´¥:",a)}},[y,b,w,t,l]);const Z=a=>{I(o=>{const H={...o};return a==="time"?o.releaseTime==="asc"?H.releaseTime="none":H.releaseTime="asc":a==="playTime"&&(o.playTime==="asc"?H.playTime="desc":H.playTime="asc"),H}),T([]),u(1),j(!0),N(0)},r=()=>{F(!A)},f=a=>{M(a),T([]),u(1),j(!0),N(0)},c=n.useCallback(a=>{sessionStorage.setItem("fromGameDetails","true"),i(`/game/${a}`)},[i]),{data:g}=he({queryKey:["gameTimeStatistics",s==null?void 0:s.SteamUserId],queryFn:ve,enabled:p&&!!(s!=null&&s.SteamUserId),staleTime:300*1e3,retry:1}),D=n.useMemo(()=>{var a;if(!(!((a=g==null?void 0:g.data)!=null&&a.timeStatistics)||g.data.timeStatistics.length===0))return g.data.timeStatistics.map(o=>({label:o.begin===0&&o.end===0?"ä»ŽæœªçŽ©è¿‡":o.end===-1?`${o.begin}h+`:`${o.begin}-${o.end}h`,count:o.num})).filter(o=>o.count>0)},[g]),Q=a=>{var G;let o=[];a.top_category_tags&&typeof a.top_category_tags=="object"&&(o=Object.values(a.top_category_tags).filter(k=>k&&typeof k=="string"&&k.trim()!=="")),o.length===0&&a.gametype&&(o=a.gametype.split(",").filter(k=>k&&k.trim()!=="")),o.length===0&&(o=["æœªåˆ†ç±»"]);const H=[];let W={};if(a.filter)if(typeof a.filter=="string")try{W=JSON.parse(a.filter)}catch(k){console.error("æ‰‹æœºç«¯è§£æžJSON filterå¤±è´¥:",k)}else typeof a.filter=="object"&&(W=a.filter);if(W&&Object.keys(W).length>0&&Object.keys(W).forEach(k=>{if(k.startsWith("gamePlatform-")&&W[k]==="true"){const V=k.replace("gamePlatform-","");V==="steam"?H.push("steam"):V==="cloudGame"&&H.push("cloud")}}),H.length===0&&a.platform){const k=a.platform.toLowerCase();k.includes("steam")&&H.push("steam"),(k.includes("cloud")||k.includes("äº‘æ¸¸æˆ")||k.includes("cloudgame"))&&H.push("cloud")}return{title:a.name||"æœªçŸ¥æ¸¸æˆ",cover:a.cover_image||a.logo||a.square_image||"",tags:o.slice(0,3),platforms:H,value:a.review_percentage||0,rating:a.review_percentage||0,releaseDate:a.release_date||"",popularity:a.watch_num||a.weight||0,category:((G=a.id)==null?void 0:G.toString())||"",playtime:a.play_time||0,language:a.sys_language_id||"æœªçŸ¥",lastOpenTime:a.updated_time?new Date(a.updated_time*1e3).toLocaleString():"",type:"normal"}};return e.jsxs("div",{className:oe.mobileLibraryContainer,children:[e.jsx(na,{}),p&&D&&D.length>0&&e.jsx(e.Fragment,{children:e.jsx(xa,{type:"duration",data:D})}),e.jsx(ks,{sortState:y,onSortChange:Z,onFilterClick:r,onFilterChange:f,isFilterActive:Object.values(b).some(a=>Array.isArray(a)&&a.length>0),showFilterPanel:A,filters:b,totalGames:$}),w.length===0&&!L?e.jsx("div",{className:oe.emptyStateContainer,children:e.jsx(ye,{})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:oe.mobileLibraryGrid,children:w.map(a=>e.jsx(de,{...Q(a),onClick:()=>c(String(a.id))},a.id))}),e.jsx("div",{className:oe.loadMoreContainer,children:e.jsx(Se,{loading:L,hasMore:l})}),e.jsx("div",{ref:Y,style:{height:"1px",width:"100%"}})]})]})},Ma=()=>Fe("(max-width: 999px)")?e.jsx(ba,{}):e.jsx("div",{children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",width:"100%",gap:"50px",minHeight:"100vh"},children:[e.jsx(Lt,{}),e.jsx(Ht,{})]})});export{Ma as default};
