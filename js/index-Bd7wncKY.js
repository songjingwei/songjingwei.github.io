import{j as e,r as c,i as C,b as k,l as P,d as f,a as g,b9 as I,aw as Q,B as S,M as _,N as L,O as E,P as M,I as T,k as W}from"./index-CybXJaB_.js";import{A as F,W as O,Q as A,C as B,a as K,b as Z}from"./goods-C3nYno30.js";import{c as q,a as D}from"./order-DSTv4xSG.js";import"./useCountdown-Dr_XpM1o.js";const j=a=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 16 16","aria-label":"Selected Icon",role:"img",...a,children:[e.jsx("title",{children:"Selected Icon"}),e.jsx("desc",{children:"选中图标"}),e.jsx("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M8 1.33301C11.6819 1.33301 14.667 4.3181 14.667 8C14.667 11.6819 11.6819 14.667 8 14.667C4.3181 14.667 1.33301 11.6819 1.33301 8C1.33301 4.3181 4.3181 1.33301 8 1.33301ZM10.4717 6.19531C10.2113 5.93497 9.78867 5.93497 9.52832 6.19531L7.33301 8.39062L6.47168 7.52832C6.21133 7.26798 5.78867 7.26798 5.52832 7.52832C5.268 7.78867 5.26799 8.21133 5.52832 8.47168L6.8623 9.80469C7.12266 10.0649 7.54438 10.065 7.80469 9.80469L10.4717 7.1377C10.7317 6.87737 10.7318 6.45557 10.4717 6.19531Z",fill:"currentColor"})]}),U=()=>{const[a,x]=c.useState("alipay"),[r,o]=c.useState(!1),[b]=C(),m=k(),h=P(),s=b.get("goods_id"),{data:n,isLoading:y,isError:v}=f({queryKey:["goodsDetail",s],queryFn:()=>Z(Number(s)),enabled:!!s}),{data:t,isLoading:p,isError:u,error:d}=f({queryKey:["qrCode",s,a],queryFn:()=>s?D({goods_id:Number(s),pay_type:a}):Promise.resolve(null),enabled:r&&!!s,refetchInterval:900*1e3});c.useEffect(()=>{s||m("/service/recharge")},[s,m]),c.useEffect(()=>{r&&s&&h.invalidateQueries({queryKey:["qrCode",s,a]})},[r,s,a,h]);const w=async()=>{if(s)try{const l=await q({good_id:Number(s),num:1,pay_type:a});let i=null;if(typeof l.data=="string"?i=l.data:l.data&&typeof l.data=="object"&&"pay_url"in l.data&&(i=l.data.pay_url),i){console.log("即将跳转到支付页面:",i),window.location.href=i;return}console.error("未找到支付链接，降级到二维码:",l),o(!0)}catch(l){console.error("创建订单失败，降级到二维码:",l),o(!0)}},N={initial:{top:"-40%"},animate:{top:"100%"}};return y?e.jsx("div",{className:"text-white",children:"加载中..."}):v||!n||!n.data?e.jsx("div",{className:"text-red-500",children:"加载商品详情失败或商品不存在"}):e.jsxs("div",{className:"relative w-full h-full min-h-screen pt-6",children:[e.jsx("div",{className:g("w-full text-center","text-b65 text-xs"),children:"选中支付方式"}),e.jsxs("div",{className:"w-full flex flex-col items-center gap-1 mt-8 font-black",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm",children:"¥"}),e.jsx("span",{className:"text-[var(--Title)] text-4xl",children:n.data.pay_price/100})]}),e.jsx("p",{className:"font-normal text-sm",children:n.data.title})]}),e.jsxs("div",{className:g("mt-8","flex flex-col","bg-b5 backdrop-blur-lg","w-[calc(100%+1rem)] -mx-[0.5rem] px-4"),children:[e.jsxs("button",{type:"button",className:"flex justify-between items-center text-b100 w-full",onClick:()=>x("alipay"),children:[e.jsxs("div",{className:"flex items-center gap-3 py-4",children:[e.jsx(I,{}),e.jsx("span",{className:"text-sm",children:"支付宝"})]}),a==="alipay"&&e.jsx(j,{color:"var(--Primary-5)"})]}),e.jsxs("button",{type:"button",className:"flex justify-between items-center text-b100 w-full",onClick:()=>x("wechat"),children:[e.jsxs("div",{className:"flex items-center gap-3 py-4",children:[e.jsx(Q,{}),e.jsx("span",{className:"text-sm",children:"微信"})]}),a==="wechat"&&e.jsx(j,{color:"var(--Primary-5)"})]})]}),e.jsx("div",{className:"absolute bottom-40 left-0 right-0 p-4 bg-[var(--b-alpha-75)] backdrop-blur-sm",children:e.jsx(S,{variant:"gamesir-primary",className:"w-full mt-4 bg-b100 text-[#131a29] hover:bg-b90",onClick:w,children:"前往支付"})}),e.jsx(_,{open:r,onOpenChange:o,children:e.jsxs(L,{className:"w-[300px] rounded-2xl p-5 bg-floating-30",children:[e.jsx(E,{children:e.jsx(M,{className:"text-center text-[var(--Title)] text-xl font-bold",children:a==="alipay"?"支付宝支付":"微信支付"})}),e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center gap-2 text-sm font-bold leading-5 text-[var(--Title)]",children:a==="alipay"?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:F,alt:"支付宝支付",className:"w-5"}),e.jsx("span",{children:"支付宝扫码支付"})]}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:O,alt:"微信支付",className:"w-5"}),e.jsx("span",{children:"微信扫码支付"})]})}),e.jsxs("div",{className:"relative w-[164px] h-[164px] rounded-2xl bg-b5 flex items-center justify-center overflow-hidden",children:[p&&e.jsx("div",{className:"text-white",children:"加载中..."}),u&&e.jsxs("div",{className:"text-red-500",children:["加载失败: ",d==null?void 0:d.message]}),(t==null?void 0:t.data)&&e.jsxs("div",{className:"relative w-[144px] h-[144px] bg-white p-2 rounded-lg",children:[e.jsx(A,{value:t.data,size:128,style:{height:"auto",maxWidth:"100%",width:"100%"}}),e.jsx("img",{src:"/images/gamesir.png",alt:"Payment Icon",className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-8 h-8 bg-white p-0.5"})]}),!p&&!u&&!(t!=null&&t.data)&&s&&e.jsx("div",{className:"text-white",children:"无法生成二维码"}),!s&&e.jsx("div",{className:"text-white",children:"请先选择一个充值套餐"}),e.jsx(T.div,{className:"absolute left-0 w-[164px] h-10 bg-gradient-to-b from-[#b2fcff00] to-[#b2fcff]",variants:N,initial:"initial",animate:"animate",transition:{duration:2.5,ease:"linear",repeat:1/0}}),e.jsx("img",{src:B,alt:"四个角高亮",className:"absolute top-0 left-0 w-full h-full"})]}),e.jsxs("div",{className:"flex items-center justify-center gap-3 text-b100 text-xs",children:[e.jsx("span",{children:"支付剩余时长"}),e.jsx(K,{seconds:900},t==null?void 0:t.data)]}),e.jsxs("div",{className:"flex items-center justify-center gap-1 text-[10px]",children:[e.jsx("span",{className:"text-b100",children:"扫码支付完成则代表同意"}),e.jsxs(W,{to:"https://gamesirworld.feishu.cn/wiki/WsntwN4OfisT74k4nZecEbldn0b",target:"_blank",children:["《",e.jsx("span",{className:"underline",children:"盖世游戏交易服务条款"}),"》"]})]})]})]})})]})};export{U as default};
