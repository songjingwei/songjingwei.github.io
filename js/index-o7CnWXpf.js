import{r as d,b as f,j as t,a}from"./index-CybXJaB_.js";import{u}from"./useInfiniteQuery-DSCseih0.js";import{g as b}from"./order-DSTv4xSG.js";import{o as N}from"./constants-C_vsFoNP.js";const _=()=>{const i=d.useRef(null),m=f(),{data:r,fetchNextPage:x,hasNextPage:l,isFetchingNextPage:n,isLoading:p}=u({queryKey:["userOrders"],queryFn:({pageParam:e=1})=>b({page:e,page_size:10}),getNextPageParam:(e,s)=>{const h=Math.ceil(e.data.total/e.data.page_size),o=s.length+1;return o>h?void 0:o},initialPageParam:1});d.useEffect(()=>{const e=i.current;if(!e)return;const s=()=>{e.scrollHeight-e.scrollTop<=e.clientHeight+1&&l&&!n&&x()};return e.addEventListener("scroll",s),()=>e.removeEventListener("scroll",s)},[l,n,x]);const g=e=>{m(`/service/order/${e.order_no}`,{state:{order:e}})},c=(r==null?void 0:r.pages.flatMap(e=>e.data.list))??[];return t.jsxs("div",{className:a("w-full h-full bg-transparent mt-5 pl-3","flex flex-col"),children:[t.jsx("h1",{className:"text-xs text-b65 flex-shrink-0",children:"购买记录"}),t.jsxs("div",{ref:i,className:a("flex-1 overflow-y-auto mt-3","w-[calc(100%+4rem)] -mx-8"),children:[p?t.jsx("div",{className:"text-center py-4 text-xs text-b65",children:"正在加载中..."}):c.length===0?t.jsx("div",{className:"text-center py-4 text-xs text-b65",children:"暂无购买记录~"}):c.map(e=>{const s=N[e.status];return t.jsxs("button",{type:"button",className:a("flex items-center justify-between w-full","border-b last:border-b-0 border-b5","text-b100","py-2.5 pl-8 pr-10","bg-b10","cursor-pointer hover:bg-b20"),onClick:()=>g(e),children:[t.jsxs("div",{className:"flex flex-col gap-1.5 text-left",children:[t.jsx("span",{className:"text-sm",children:"云游戏服务-"+e.goods_name}),t.jsx("span",{className:"text-xs text-b65",children:e.pay_time?new Date(e.pay_time*1e3).toLocaleString():""})]}),t.jsxs("div",{className:"flex flex-col items-center gap-1.5",children:[t.jsx("span",{className:a("px-2.5 py-[1px] rounded text-xs",s==null?void 0:s.color),children:s==null?void 0:s.text}),t.jsxs("span",{className:"text-xs font-bold",children:["¥",(e.pay_price/100).toFixed(2)]})]})]},e.order_no)}),n&&t.jsx("div",{className:"text-center py-4 text-xs text-b65",children:"正在加载中..."}),!l&&c.length>0&&t.jsx("div",{className:"text-center py-4 text-xs text-b65",children:"已经到底啦~"})]})]})};export{_ as default};
